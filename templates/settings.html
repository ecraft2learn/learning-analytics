<hr>
<div class='row'>
<button id='refresh' class='btn btn-info'>
	<span class='glyphicon glyphicon-refresh' aria-hidden='true'></span>
	Refresh data set from server
</button>
<button id='use-file' class='btn btn-info'>
	<span class='glyphicon glyphicon-level-up' aria-hidden='true'></span>
	Load data set from file
</button>
<button id='reset-miners' class='btn btn-danger'>
	<span class='glyphicon glyphicon-hand-down' aria-hidden='true'></span>
	Reset miners
</button>
<button id='train-decision-tree' class='shortcut-train btn btn-success'>
    <span class='glyphicon glyphicon-wrench' aria-hidden='true'></span>
    Train classifier
</button>
<button id='train-outlier' class='shortcut-train btn btn-success'>
    <span class='glyphicon glyphicon-wrench' aria-hidden='true'></span>
    Train anomaly detector
</button>
</div>
<br>
<br>
<div class="form-group" id='train-set-div'>
    <label for="exampleInputFile">File input</label>
    <input type="file" id="train-set">
</div>
<div id='settings-div'>
<blockquote id='instructions'>
	<p>Steps: 1: Reduce time frame if needed. 2: Group data sets by attribute. 3: Normalize vectors by attribute.</p>
	<footer>The time frame reducing has to be the first step.</footer>
</blockquote>
<input id='start-time' placeholder='start time filter'>
<input id='end-time' placeholder='end time filter'>
<div class='well' id='group-by'></div>
<div class='well' id='normalize'></div>
<div class='well' id='attributes'></div>
    <select id='data-source-select'>
        <option value='uui'>UUI</option>
        <option value='snap'>Programming</option>
        <option value='print'>3D printing</option>
        <option value='brainstrom'>Brainstorming</option>
    </select>
    <div id='data-set-table'></div>
</div>
<div id='data-set-table'></div>
<script>
    
    // this goes to analytics-ui
    var urls = {
        
        snap: location.protocol === 'https:' ? 'https://cs.uef.fi/~tapanit/test2.php' : 'http://cs.uef.fi/~tapanit/test2.php',
        uui: location.protocol === 'https:' ? 'https://cs.uef.fi/~tapanit/get_uui_vectors_pilot_1.php' : 'http://cs.uef.fi/~tapanit/get_uui_vectors_pilot_1.php',
        print: location.protocol === 'https:' ? '' : '',
        brainstrom: location.protocol === 'https:' ? '' : ''
        
    };
    // also notify urls
    
    window.sessionStorage.setItem('dataSource', urls['uui']);

	$('#settings-div').hide();
	$('.shortcut-train').hide();

	if (window && window.process && window.process.type)
		$('#refresh').hide();

	var trigger = false;
    
     $('#data-source-select').on('change', function(event) {
       
        var value = $(this).val();
         
        window.sessionStorage.setItem('dataSource', urls[value]);
         
        resetMiners();
         
        analysisObjects.miners.dataSet = [];
        analysisObjects.miners.curDataSet = null;
        // TODO the rest, add method to analytics-ui.js
         
        window.sessionStorage.setItem('lastId', 0);
         
        $('#refresh').click();
        
    });

	$('#train-set').on('change', function(event) {
	
		parseTrainSet(event);
		
		$('.shortcut-train').show();
	
	});
	
	$('#refresh').on('click', function(event) {
	
		showLoader();
	
		var lastId = window.sessionStorage.getItem('lastId') ? parseInt(window.sessionStorage.getItem('lastId')) + 1: 0;

		var url = window.sessionStorage.getItem('dataSource');	
        
		var http = new HTTP(url, 'POST');
		
		var data = 'sessionId=' + window.sessionStorage.getItem('sessionId') +
			'&lastId=' + lastId;
        
        console.log(data);
		
		http.fetchDataSet(data, function(response) {
		
			var dataset = JSON.parse(response);
            
            console.log(dataset);
			
			if (dataset.length > 0) {
			
				window.sessionStorage.setItem('lastId', dataset[dataset.length - 1]['vector_id']);
				
				fetchDataSet(dataset);
				
				initOptions(dataset);
					
				$('.analysis-tools').show();
				$('#settings-div').fadeIn();
								
				$('.shortcut-train').show();
			
			}
			
			hideLoader();	

		
		}, function(error) {
		
			console.log(error);
			
			hideLoader();
		
		});
	
	});
	
	$('#use-file').on('click', function(event) {
	
		if (! trigger) {
		
			$('<div></div>').dialog({close: function() { trigger = true; $('#train-set').val(''); $('#train-set').click(); }}).
				html('<p>Your file format has to be a JSON array and has to contain keys users and id</p>');
		
		} else {
	
			$('#train-set').val('');
			$('#train-set').click();
		
		}
	
	});
	
	$('#reset-miners').on('click', function(event) {
	
		resetMiners();
	
	});
	
	$('#train-decision-tree').on('click', function(event) {
	
		new DecisionTree();
		
		setMessage('Decision tree has been trained');
	
	});
	
	$('#train-outlier').on('click', function(event) {
	
		new Anomaly();
		
		setMessage('Anomaly detector has been trained');
	
	});

</script>
