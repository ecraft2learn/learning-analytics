"use strict";var analysisObjects=analysisObjects||{};analysisObjects.miners={neuralNTree:null,neuralNTreeSettings:null,decisionTree:null,decisionTreeSettings:null,anomaly:null,anomalySettings:null,charts:null,chartsSettings:null,settings:null,dataSet:null,curDataSet:null,groupDataSet:null,neuralNTreeHeaders:null,neuralNTreeNotes:null,apriori:null,ignoredAttributes:{id:true,wellPerformed:true,hiddenId:true,vector_id:true,session_id:true,users:true,timestamp:true,anomaly:true},classificationWellPerformed:{},minTime:null,maxTime:null,reducedTimeDataSet:null,resetDatasets:function(){analysisObjects.miners.dataSet=[];analysisObjects.miners.curDataSet=null;analysisObjects.miners.groupDataSet=null;analysisObjects.miners.reducedTimeDataSet=null;analysisObjects.miners.classificationWellPerformed={}}};analysisObjects.uiConstants={wrapper:"#analysis-content",settings:"#analysis-settings",removeContent:function(){if(tinymce.activeEditor){tinymce.activeEditor.remove()}$(this.wrapper).html("");var a=$(this.settings);a.hide()}};analysisObjects.urls={templateUrl:window.location.href.replace("index.html","")+"templates/",baseUrl:location.protocol==="https:"?"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/":"http://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/"};analysisObjects.dataFetchUrls={snap:analysisObjects.urls.baseUrl+"get_programming_vectors_pilot_2.php",uui:analysisObjects.urls.baseUrl+"get_uui_vectors_pilot_2.php",print:analysisObjects.urls.baseUrl+"get_search_vectors_pilot_2.php",brainstorm:analysisObjects.urls.baseUrl+"get_brainstorm_vectors_pilot_2.php",todo:analysisObjects.urls.baseUrl+"get_todo_vectors_pilot_2.php"};analysisObjects.notifyUrls={snap:analysisObjects.urls.baseUrl+"notify_programming.php",uui:analysisObjects.urls.baseUrl+"notify_uui.php",print:analysisObjects.urls.baseUrl+"notify_print.php",brainstorm:analysisObjects.urls.baseUrl+"notify_brainstorm.php"};var Settings=function(){};Settings.prototype.reset=function(){analysisObjects.miners.settings=null;this.settings=null};Settings.prototype.save=function(){analysisObjects.miners.settings=this};var Association=function(d,f,b,g){var a=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;var c=[];for(var e=0;e<a.length;e++){c.push(getInputVectorTextKey(a[e]))}this.trainingSet=c;this.apriori=new Apriori.Algorithm(d,f,b,g).showAnalysisResultFromFile(this.trainingSet);this.save()};Association.prototype.save=function(){analysisObjects.miners.apriori=this};Association.prototype.reset=function(){analysisObjects.miners.apriori=null;this.apriori=null};var NeuralNTree=function(d,c,a,g,e,f){if(!analysisObjects.miners.neuralNTree){var b={};b.size=d*2+-1;b.dimensions=e;b.learningRate=g;b.scaleMin=c;b.scaleMax=a;this.neuralNTree=new NNTFunctions.NeuralNTree(b);this.save()}else{this.neuralNTree=analysisObjects.miners.neuralNTree.neuralNTree}};NeuralNTree.prototype.save=function(){analysisObjects.miners.neuralNTree=this};NeuralNTree.prototype.reset=function(){analysisObjects.miners.neuralNTree=null;analysisObjects.miners.neuralNTreeSettings=null;this.neuralNTree=null};var DecisionTree=function(){this.data=JSON.parse(JSON.stringify(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet));var c=[];for(var b=this.data.length-1;b>=0;b--){if(typeof this.data[b]["wellPerformed"]==="undefined"||this.data[b]["wellPerformed"]==-2){this.data.splice(b,1)}else{this.data[b]["wellPerformed"]=parseInt(this.data[b]["wellPerformed"])}}for(var b=0;b<this.data.length;b++){var d={};for(var a in this.data[b]){if(!(a in analysisObjects.miners.ignoredAttributes)||a==="wellPerformed"){if(!isNaN(this.data[b][a])){d[a]=parseFloat(this.data[b][a])}else{d[a]=this.data[b][a]}}}c.push(d)}this.data=c;this.config={trainingSet:this.data,categoryAttr:"wellPerformed",};this.decisionTree=new dt.DecisionTree(this.config);this.save()};DecisionTree.prototype.save=function(){analysisObjects.miners.decisionTree=this};DecisionTree.prototype.reset=function(){analysisObjects.miners.decisionTree=null;this.decisionTree=null};var Anomaly=function(){this.data=JSON.parse(JSON.stringify(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet));var c=[];for(var b=this.data.length-1;b>=0;b--){if(this.data[b]["anomaly"]==-1){this.data[b]["anomaly"]=-1}else{if(this.data[b]["anomaly"]==0){this.data[b]["anomaly"]=0}else{this.data[b]["anomaly"]=1}}}for(var b=0;b<this.data.length;b++){var d={};for(var a in this.data[b]){if(!(a in analysisObjects.miners.ignoredAttributes)||a==="anomaly"){if(!isNaN(this.data[b][a])){d[a]=parseFloat(this.data[b][a])}else{d[a]=this.data[b][a]}}}c.push(d)}for(var b=c.length-1;b>=0;b--){if(c[b]["anomaly"]==0){c.splice(b,1)}}this.data=c;this.config={trainingSet:this.data,categoryAttr:"anomaly",};this.anomaly=new dt.DecisionTree(this.config);this.save()};Anomaly.prototype.save=function(){analysisObjects.miners.anomaly=this};Anomaly.prototype.reset=function(){this.outlier=null;analysisObjects.miners.anomaly=null};var Charts=function(){};function initSettings(){analysisObjects.uiConstants.removeContent();this.settings=analysisObjects.miners.settings||new Settings();this.createUI();logSettings()}initSettings.prototype.createUI=function(){var a=$(analysisObjects.uiConstants.settings);a.show();if(a.html()===""){a.load("templates/settings.html",function(){})}};function initCluster(){analysisObjects.uiConstants.removeContent();initNeuralNTreeSettings();this.settings=analysisObjects.miners.neuralNTreeSettings||null;this.neuralNTree=analysisObjects.miners.neuralNTree||null;this.createUI()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}initCluster.prototype.createUI=function(){var c=$(analysisObjects.uiConstants.wrapper);var a=this;showLoader();var b=isChrome()?analysisObjects.urls.templateUrl+"cluster.html":"templates/cluster.html";c.load(b,function(){if(a.settings){if(a.settings.size){$("#max-clusters").val(a.settings.size)}if(a.settings.alpha){$("#alpha").val(a.settings.alpha)}$("#dimensions").val(a.settings.dimensions);$("#min").val(a.settings.min);$("#max").val(a.settings.max)}if(a.neuralNTree){a.visualiseNeuralNTree()}$("#forward").on("click",function(f){showLoader();if(!a.neuralNTree){try{var n=parseInt($("#max-clusters").val()),g=parseFloat($("#alpha").val()),d=parseInt($("#dimensions").val()),h=parseFloat($("#min").val()),m=parseFloat($("#max").val());if(h==0){h=1e-7}if(m==0){m=1e-7}}catch(l){alert("Not a valid Neural N-Tree parameter");return}a.neuralNTree=new NeuralNTree(n,h,m,g,d);a.settings={};a.settings.size=n;a.settings.alpha=g;a.settings.dimensions=d;a.settings.min=h;a.settings.max=m;analysisObjects.miners.neuralNTreeSettings=a.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){var k=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;for(var j=0;j<k.length;j++){a.neuralNTree.neuralNTree.forwardTrain(getInputVector(k[j]))}a.visualiseNeuralNTree()}else{alert("No data set specified")}hideLoader()});$("#backward").on("click",function(f){showLoader();if(!a.neuralNTree){try{var n=parseInt($("#max-clusters").val()),g=parseFloat($("#alpha").val()),d=parseInt($("#dimensions").val()),h=parseFloat($("#min").val()),m=parseFloat($("#max").val());if(h==0){h=1e-7}if(m==0){m=1e-7}}catch(l){alert("Not a valid Neural N-Tree parameter");return}a.neuralNTree=new NeuralNTree(n,h,m,g,d);a.settings={};a.settings.size=n;a.settings.alpha=g;a.settings.dimensions=d;a.settings.min=h;a.settings.max=m;analysisObjects.miners.neuralNTreeSettings=a.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){var k=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;for(var j=0;j<k.length;j++){a.neuralNTree.neuralNTree.backwardTrain(getInputVector(k[j]))}a.visualiseNeuralNTree()}else{alert("No data set specified")}hideLoader()});$("#cluster").on("click",function(w){showLoader();if(!a.neuralNTree){try{var r=parseInt($("#max-clusters").val()),f=parseFloat($("#alpha").val()),k=parseInt($("#dimensions").val()),t=parseFloat($("#min").val()),x=parseFloat($("#max").val());if(t==0){t=1e-7}if(x==0){x=1e-7}}catch(B){alert("Not a valid Neural N-Tree parameter");return}a.neuralNTree=new NeuralNTree(r,t,x,f,k);a.settings={};a.settings.size=r;a.settings.alpha=f;a.settings.dimensions=k;a.settings.min=t;a.settings.max=x;analysisObjects.miners.neuralNTreeSettings=a.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){var l=[];var C=Object.assign([],a.lastNodes);a.nodes.update(C);var u=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;for(var y=0;y<u.length;y++){var z=a.neuralNTree.neuralNTree.cluster(getInputVector(u[y])).index;if(!l[z]){l[z]=[]}l[z].push(getInputVector(u[y]));var o=u[y];var s="";for(var v=0,A=u[y].length;v<A;v++){s+=v<A-1?u[y][v].toFixed(4)+", ":u[y][v].toFixed(4)}var r=a.nodes.get(z).size;var m=a.nodes.get(z).info;var n=a.nodes.get(z).featureCount;var D=a.nodes.get(z).label+"";n++;if($(m).prop("tagName")==="INPUT"){m=$(m).val();m="["+m+"]";m=JSON.parse(m);var h="<table class='table' style='width: 100%;'><tr>";var d=getHeaders(u[y]);for(var v=0,A=m.length;v<A;v++){h+="<th>"+d[v]+"</th>"}h+="<th>Users</th>";h+="</tr><tr>";o=getInputVector(o);for(var v=0;v<o.length;v++){h+="<td>"+ +o[v].toFixed(4)+"</td>"}if(analysisObjects.miners.neuralNTreeNotes&&analysisObjects.miners.neuralNTreeNotes[y]){h+="<td>"+analysisObjects.miners.neuralNTreeNotes[y]+"</td>"}else{if(u[y]["users"]){h+="<td>"+u[y]["users"]+"</td>"}else{if(u[y]["id"]){h+="<td>"+u[y]["id"]+"</td>"}else{h+="<td>No notes</td>"}}}h+="</tr>";h+="</table>"}else{var q=m.substring(0,m.length-8);var p="<tr>";o=getInputVector(o);for(var v=0,A=o.length;v<A;v++){p+="<td>"+ +o[v].toFixed(4)+"</td>"}if(analysisObjects.miners.neuralNTreeNotes&&analysisObjects.miners.neuralNTreeNotes[y]){p+="<td>"+analysisObjects.miners.neuralNTreeNotes[y]+"</td>"}else{if(u[y]["users"]){p+="<td>"+u[y]["users"]+"</td>"}else{if(u[y]["id"]){p+="<td>"+u[y]["id"]+"</td>"}else{p+="<td>No notes</td>"}}}p+="</tr></table>";var h=q+p}m+="<br>"+JSON.stringify(o);D=D.split("\n")[0]+"\nn = "+n;r+=0.3;a.nodes.update({id:z,size:r,points:a.nodes.get(z).currentPoints+"<hr>"+h,info:h,featureCount:n,label:D})}var g=[];for(var y=0;y<l.length;y++){for(var v=0;v<l.length;v++){if(y!==v){if(l[y]&&l[v]&&l[y].length>1&&l[v].length>1){var C=a.silhouette(l[y],l[v]);g.push({"How similar the clusters are (-1 to 1)":C,Cluster:y,"Compared cluster":v})}}}}g.sort(function(i,e){if(i["How similar the clusters are (-1 to 1)"]<e["How similar the clusters are (-1 to 1)"]){return -1}else{if(i["How similar the clusters are (-1 to 1)"]>e["How similar the clusters are (-1 to 1)"]){return 1}else{return 0}}});a.createSilhouetteTable(g);logCluster()}else{alert("No data set specified")}hideLoader()});$("#forward").click();$("#cluster").click();$("#reset-cluster").on("click",function(d){a.neuralNTree=null;if(analysisObjects.miners.neuralNTree){analysisObjects.miners.neuralNTree.reset()}setMessage("Neural N-Tree has been reseted")});hideLoader()})};initCluster.prototype.createSilhouetteTable=function(d){var c="<table class='table'><thead><tr>";for(var b in d[0]){c+="<th>"+b+"</th>"}c+="</tr><tbody>";for(var a=0;a<d.length;a++){c+=d[a]["How similar the clusters are (-1 to 1)"]>0?"<tr class='success'>":"<tr class='danger'>";for(var b in d[a]){c+="<td>"+ +d[a][b].toFixed(2)+"</td>"}c+="</tr>"}c+="</tbody></table>";$("#silhouettes").html(c)};initCluster.prototype.silhouette=function(g,d){this.euclidean=function(m,k){var l=0;for(var j=0;j<m.length;j++){l+=(m[j]-k[j])*(m[j]-k[j])}return Math.sqrt(l)};var c=0,e=0,h=0,f=0;for(var b=0;b<g.length;b++){for(var a=0;a<g.length;a++){c+=this.euclidean(g[b],g[a]);e++}for(var a=0;a<d.length;a++){h+=this.euclidean(g[b],d[a]);f++}}c=c/e;h=h/f;return(h-c)/Math.max(c,h)};initCluster.prototype.visualHypertree=function(){var b=this.neuralNTree.neuralNTree.toJSON();var a=new $jit.Hypertree({injectInto:"neural-n-tree-hyperbolic",width:800,height:800,Node:{dim:9,color:"#f00"},Edge:{lineWidth:2,color:"#088"},onBeforeCompute:function(c){},onCreateLabel:function(d,c){d.innerHTML=c.name;$jit.util.addEvent(d,"click",function(){a.onClick(c.id,{onComplete:function(){var h=c.id.split("_")[0];var g=self.neuralNTree.neuralNTree.levelOrder();for(var f=0;f<g.length;f++){for(var e=0;e<g[f].length;e++){if(h===g[f][e].index){}}}a.controller.onComplete()}})})},onPlaceLabel:function(g,e){var d=g.style;d.display="";d.cursor="pointer";if(e._depth<=1){d.fontSize="0.8em";d.color="#ddd"}else{if(e._depth==2){d.fontSize="0.7em";d.color="#555"}else{d.display="none"}}var f=parseInt(d.left);var c=g.offsetWidth;d.left=(f-c/2)+"px"},onComplete:function(){}});a.loadJSON(b);a.refresh();a.controller.onComplete();this.ht=a};initCluster.prototype.visualiseNeuralNTree=function(){var s=this;this.mergeIndices={};this.nodes=new vis.DataSet();this.edges=new vis.DataSet();this.levelCount=0;if(this.visual){this.visual.destroy();this.visual=null}this.lastNodes=[];var l=this.neuralNTree.neuralNTree.levelOrder(this.neuralNTree.neuralNTree.rootNode);var z=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;for(var C=l.length-1;C>=0;C--){var B=false;for(var A=0,D=l[C].length;A<D;A++){if(null!==l[C][A]){B=true}}if(!B){l.splice(C,1)}}var m=[];for(var C=0,D=l[0][0].point.length;C<D;C++){m.push(l[0][0].point[C])}for(var C=0,D=l.length;C<D;C++){for(var A=0,g=l[C].length;A<g;A++){if(l[C][A]!==null){for(var x=0,n=l[C][A].point.length;x<n;x++){if(m[x]>l[C][A].point[x]){m[x]=l[C][A].point[x]}if(m[x]==0){m[x]=1e-8}}}}}var o=null,y=null;for(var C=0,c=l.length;C<c;C++){for(var A=0,g=l[C].length;A<g;A++){if(l[C][A]!==null&&l[C][A]!==this.neuralNTree.neuralNTree.rootNode&&l[C][A]!==this.neuralNTree.neuralNTree.rootNode.left&&l[C][A]!==this.neuralNTree.neuralNTree.rootNode.right){var E=l[C][A].point;var a=NNTFunctions.util.similarity(E,m);if(o===null){o=a}if(y===null){y=a}if(o<a){o=a}if(y>a){y=a}}}}this.levelCount=l.length;var b=getHeaders(z[0]);for(var C=0,D=l.length;C<D;C++){for(var A=0,e=l[C].length;A<e;A++){if(null!==l[C][A]){var u="<input type='text' style='width: 290px;' value='";var v=l[C][A].point;var r="<div class='nnt-point-container'>";for(var x=0,n=v.length;x<n;x++){u+=x!==n-1?v[x].toFixed(4)+", ":v[x].toFixed(4);r+="<div class='input-group'><span class='input-group-addon'>"+b[x]+"</span><input type='text' id='node-index_"+x+"_"+l[C][A].index+"' class='node-index' onchange='pointChange(this)'></div>"}r+="</div>";u+="' placeholder='point' id='node-index_"+l[C][A].index+"' class='node-index' onchange='pointChange(this)'>";var a=NNTFunctions.util.similarity(v,m);a=parseInt(NNTFunctions.util.convertRange([a],[o,y],[0,255]));var q=l[C][A].isTerminal?"Terminal "+l[C][A].index:"Node "+l[C][A].index;if(a<0){a=0}else{if(a>255){a=255}}var h=255-a;var w=a;var t=255-a;var f="rgba("+h+","+w+","+t+",1)";if(l[C][A].mergeIndex){this.mergeIndices[l[C][A].mergeIndex]=true}this.nodes.add({id:l[C][A].index,label:l[C][A].index,level:C,info:u,points:r,size:25,shape:"square",featureCount:0,color:f,nodeHeader:q,cid:l[C][A].mergeIndex,currentPoints:r});this.lastNodes.push({id:l[C][A].index,label:l[C][A].index,level:C,info:u,points:r,size:25,shape:"square",featureCount:0,color:f,nodeHeader:q,cid:l[C][A].mergeIndex,currentPoints:r});if(null!==l[C][A].parent){this.edges.add({from:l[C][A].index,to:l[C][A].parent.index})}}}}var p=document.getElementById("neural-n-tree-visual");var F={nodes:this.nodes,edges:this.edges};var d={edges:{smooth:{type:"cubicBezier",forceDirection:"vertical",roundness:0.4}},layout:{hierarchical:{direction:"UD"}},physics:false};this.visual=new vis.Network(p,F,d);this.visual.on("click",function(M){var j=M.nodes;var P=s.nodes.get(j);if(!P||!P[0]){return}if(P&&P[0]&&P[0].points){var N=P[0].points;var J=P[0].nodeHeader;var G=$("<div class='change-nnt-point'></div>").html(N).dialog({width:750,height:600,closeOnEscape:false,title:J,close:function(){$(this).dialog("destroy").remove()}});var L=s.neuralNTree.neuralNTree.nodesByIndex([j[0]]).point;for(var H=0,K=L.length;H<K;H++){L[H]=parseFloat(L[H])}var k=$(".change-nnt-point .node-index");var I=[];for(var O in k){if(k.hasOwnProperty(O)&&k[O].nodeName==="INPUT"){I.push(k[O])}}for(var H=I.length-1;H>=0;H--){if(I[H].id.split("_")[2]!=j[0]){I.splice(H,1)}}for(var H=0;H<I.length;H++){I[H].value=L[H]==0?L[H]:L[H].toFixed(4)}}})};function initClassification(){analysisObjects.uiConstants.removeContent();this.classification=analysisObjects.miners.decisionTree||new DecisionTree();this.createUI()}initClassification.prototype.createUI=function(){var c=$(analysisObjects.uiConstants.wrapper);var a=this;showLoader();var b=isChrome()?analysisObjects.urls.templateUrl+"classification.html":"templates/classification.html";c.load(b,function(){a.tree=a.classification.decisionTree;a.nodes=new vis.DataSet();a.edges=new vis.DataSet();a.levelCount=0;if(a.visual){a.visual.destroy();a.visual=null}var l=getLevelOrder(a.tree.root);for(var t=0,u=l.length;t<u;t++){a.levelCount++;for(var s=0,f=l[t].length;s<f;s++){if(null!==l[t][s]&&"undefined"!==typeof l[t][s]){var v=1;var d=l[t][s].parent;while(l[t].indexOf(d)>-1){v++;d=d.parent}var g=l[t][s].predicateName;var p="";if(g===">="){p=" is greater than or equal to "}else{if(g==="<="){p=" is less than or equal to "}else{if(g==="=="){p=" is equal to "}else{p=" is not equal to "}}}var m=l[t][s].pivot;if(!isNaN(m)){m=+m.toFixed(2)}a.nodes.add({label:!l[t][s].category?l[t][s].attribute+p+m:l[t][s].category==1?"well":l[t][s].category==0?"neurtral":"not well",level:a.levelCount+v,id:l[t][s].index,size:25,shape:"square",featureCount:0,color:l[t][s].category==1?"green":l[t][s].category==0?"blue":l[t][s].category?"red":!l[t][s].noMatch?"yellow":"orange",info:l[t][s].pivot,predicate:l[t][s].predicateName,nodeId:l[t][s].index,attribute:l[t][s].attribute,category:l[t][s].category});var w=l[t][s].noMatch?"no":"yes";if(null!==l[t][s].parent&&"undefined"!==typeof l[t][s].parent){a.edges.add({from:l[t][s].index,to:l[t][s].parent.index,label:w})}}}}var o=document.getElementById("display-tree");var x={nodes:a.nodes,edges:a.edges};var e={edges:{smooth:{type:"cubicBezier",forceDirection:"vertical",roundness:0.4}},layout:{hierarchical:{direction:"UD"}},physics:false};a.visual=new vis.Network(o,x,e);a.visual.on("afterDrawing",function(i){logClassification()});if(automatic){var r=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;var x=[];for(var t=0;t<r.length;t++){var n={};for(var y in r[t]){if(y==="users"||!(y in analysisObjects.miners.ignoredAttributes)&&y!=="wellPerformed"){n[y]=r[t][y]}}x.push(n)}var h=[];for(var t=0;t<x.length;t++){var k=analysisObjects.miners.decisionTree.decisionTree.predict(x[t]);$("#users").html("");var q={};q.users=x[t]["users"];q.status=k;h.push(q)}generateUserList(h)}a.visual.on("click",function(z){var A=z.nodes;var C=a.nodes.get(A);if(!C||!C[0]){return}if(C&&C[0]&&C[0].info){var i=!isNaN(C[0].info)?+C[0].info.toFixed(2):C[0].info;var D="Feature value <input class='pivot' value='"+i+"' id='pivot_"+C[0].nodeId+"'><br>";if(C[0].predicate==="=="){D+="How to compare <select id='predicate_"+C[0].nodeId+"' class='predicate'><option value='==' selected='selected'>equal</option><option value='!='>not equal</option><option value='>='>greater than or equal</option><option value='<='>less than or equal</option></select>"}else{if(C[0].predicate===">="){D+="How to compare <select id='predicate_"+C[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!='>not equal</option><option value='>=' selected='selected'>greater than or equal</option><option value='<='>less than or equal</option></select>"}else{if(C[0].predicate==="<="){D+="How to compare <select id='predicate_"+C[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!='>not equal</option><option value='>='>greater than or equal</option><option value='<=' selected='selected'>less than or equal</option></select>"}else{D+="How to compare <select id='predicate_"+C[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!=' selected='selected'>not equal</option><option value='>='>greater than or equal</option><option value='<='>less than or equal</option></select>"}}}D+="<br>";D+="Feature <select id='attribute_"+C[0].nodeId+"' class='attribute'>";for(var j in analysisObjects.miners.dataSet[0]){if(!(j in analysisObjects.miners.ignoredAttributes)){D+=C[0].attribute==j?"<option value='"+j+"' selected='selected'>"+j+"</option>":"<option value='"+j+"'>"+j+"</option>"}}D+="</select>";var B=$("<div></div>").html(D).dialog({width:300,height:400,closeOnEscape:false,close:function(){$(this).dialog("destroy").remove()}});$(".pivot").on("change",function(G){var J=G.target.id;var I=J.split("_")[1];var H=getLevelOrder(a.tree.root);for(var F=0;F<H.length;F++){for(var E=0;E<H[F].length;E++){if(H[F][E]){if(H[F][E].index==I){H[F][E].pivot=$("#"+J).val()}}}}a.createUI()});$(".predicate").on("change",function(G){var J=G.target.id;var I=J.split("_")[1];var H=getLevelOrder(a.tree.root);for(var F=0;F<H.length;F++){for(var E=0;E<H[F].length;E++){if(H[F][E]&&H[F][E].index==I){H[F][E].predicateName=$("#"+J).val()}}}a.createUI()});$(".attribute").on("change",function(G){var J=G.target.id;var I=J.split("_")[1];var H=getLevelOrder(a.tree.root);for(var F=0;F<H.length;F++){for(var E=0;E<H[F].length;E++){if(H[F][E]&&H[F][E].index==I){H[F][E].attribute=$("#"+J).val()}}}a.createUI()})}else{var D=C[0].category==1?"<select id='category_"+C[0].nodeId+"' class='category'><option value='1' selected='selected'>Good</option><option value='0' selected='selected'>Medium</option><option value='-1'>Bad<option></select>":"<select id='category_"+C[0].nodeId+"' class='category'><option value='1'>Good</option><option value='0'>Medium</option><option value='-1' selected='selected'>Bad<option></select>";var B=$("<div></div>").html(D).dialog({width:300,height:400,closeOnEscape:false,close:function(){$(this).dialog("destroy").remove()}});$(".category").on("change",function(G){var J=G.target.id;var I=J.split("_")[1];var H=getLevelOrder(a.tree.root);for(var F=0;F<H.length;F++){for(var E=0;E<H[F].length;E++){if(H[F][E]&&H[F][E].index==I){H[F][E].category=parseInt($("#"+J).val())}}}a.createUI()})}});a.generateClassificationTable();hideLoader()})};initClassification.prototype.generateClassificationTable=function(){var c=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;var f=[];for(var b=0;b<c.length;b++){var g={};for(var a in c[b]){if(a==="users"||!(a in analysisObjects.miners.ignoredAttributes)&&a!=="wellPerformed"){g[a]=c[b][a]}}f.push(g)}var h="<table id='c-table' class='table'><thead><tr>";for(var a in f[0]){h+="<th>"+a+"</th>"}h+="</tr><tbody>";for(var b=0;b<f.length;b++){var d=this.tree.predict(f[b]);var g=f[b];h+=d==1?"<tr class='success'>":d==0?"<tr>":"<tr class='danger'>";for(var a in g){if(!(a in analysisObjects.miners.ignoredAttributes)||a==="users"){var e=g[a];e=!isNaN(e)?+e.toFixed(2):e;h+="<td>"+e+"</td>"}}h+="</tr>"}h+="</tbody></table>";$("#classification-table").html(h);$("#c-table").tablesorter()};function initAnomaly(){analysisObjects.uiConstants.removeContent();this.createUI()}initAnomaly.prototype.createUI=function(){var c=$(analysisObjects.uiConstants.wrapper);var a=this;showLoader();var b=isChrome()?analysisObjects.urls.templateUrl+"anomaly.html":"templates/anomaly.html";c.load(b,function(){if(!analysisObjects.miners.anomaly){if(analysisObjects.miners.dataSet){try{a.anomaly=new Anomaly()}catch(f){hideLoader();return}}else{alert("No data set loaded")}}$("#apply-anomaly").on("click",function(e){showLoader();var r=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;var m=[];var p="";for(var n=0;n<r.length;n++){var l={};for(var q in r[n]){if(q==="users"||!(q in analysisObjects.miners.ignoredAttributes)&&q!=="anomaly"){l[q]=r[n][q]}}m.push(l)}var o=[];for(var n=0;n<m.length;n++){var k=a.anomaly.anomaly.predict(m[n])==-1?true:false;o.push({input:getInputVectorTextAllAttributes(r[n]),status:k})}p="<table id='a-table' class='table'><thead><tr>";var g=getKeysAllAttributes(r[0]);for(var n=0;n<g.length;n++){p+="<th>"+g[n]+"</th>"}p+="</tr></thead><tbody>";for(var n=0;n<o.length;n++){p+=o[n].status?"<tr class='danger'>":"<tr class='success'>";for(var h=0;h<o[n].input.length;h++){if(o[n].input[h]==0.000001){o[n].input[h]=0}if(!isNaN(o[n].input[h])){p+="<td>"+ +o[n].input[h].toFixed(2)+"</td>"}else{p+="<td>"+o[n].input[h]+"</td>"}}p+="</tr>"}p+="</tbody></table>";$("#anomaly-table").html(p);$("#a-table").tablesorter();hideLoader();logAnomaly()});hideLoader();if(analysisObjects.miners.anomaly){a.anomaly=analysisObjects.miners.anomaly;var d=analysisObjects.miners.anomaly.th||$("#anomaly-threshold").val();$("#anomaly-threshold").val(d);$("#apply-anomaly").click()}})};function initCharts(){this.createUI()}initCharts.prototype.createUI=function(){var h=$(analysisObjects.uiConstants.wrapper);var c=this;showLoader();$("#charts-radar").remove();$("#charts-line").remove();c.dataSet=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;c.curDataSet=[];var a=function(){var k=Math.floor(Math.random()*250);var j=Math.floor(Math.random()*250);var i=Math.floor(Math.random()*250);return"rgba("+k+","+j+","+i+",0.3)"};for(var e in c.dataSet[0]){var b=[];if(isNaN(c.dataSet[0][e])||e in analysisObjects.miners.ignoredAttributes){continue}for(var d=0;d<c.dataSet.length;d++){b.push(c.dataSet[d][e])}c.curDataSet.push({label:e,data:b,backgroundColor:a()})}c.labels=[];for(var d=0;d<c.dataSet.length;d++){c.labels.push(d+"")}var g={type:"radar",data:{labels:c.labels,datasets:c.curDataSet},options:{}};var f={type:"line",data:{labels:c.labels,datasets:c.curDataSet},options:{}};c.chartOptions=g;c.radarChart=chart;c.lineChart=lineChart;hideLoader()};function initApriori(){analysisObjects.uiConstants.removeContent();this.createUI()}initApriori.prototype.createUI=function(){var c=$(analysisObjects.uiConstants.wrapper);var a=this;var b=isChrome()?analysisObjects.urls.templateUrl+"apriori.html":"templates/apriori.html";c.load(b,function(){$("#apriori-apply").on("click",function(g){var d=$("#apriori-min-confidence").val();var i=$("#apriori-min-support").val();var f=$("#apriori-iterations").val();try{d=parseFloat(d);i=parseFloat(i);f=parseInt(f)}catch(h){alert("Not a proper apriori-value");return}a.apriori=new Association(d,i,false,f).apriori;a.buildUI()});if(analysisObjects.miners.apriori){a.apriori=analysisObjects.miners.apriori.apriori;a.buildUI()}$("#apriori-apply").click()})};initApriori.prototype.buildUI=function(){var r=this.apriori.frequentItemSets;var g=this.apriori.associationRules;var f="<table id='asso-table' class='table'><thead><tr><th>LHS</th><th>RHS</th><th>Confidence</th></tr></thead><tbody>";var n=[];var b=[];var p={};for(var t=0;t<g.length;t++){var e=g[t];var o={};o.id=e.lhs.join();for(var q=0;q<e.lhs.length;q++){e.lhs[q]=!isNaN(e.lhs[q])?+e.lhs[q].toFixed(2):e.lhs[q]}o.label=e.lhs.join();var a={};a.id=e.rhs.join();for(var q=0;q<e.rhs.length;q++){e.rhs[q]=!isNaN(e.rhs[q])?+e.rhs[q].toFixed(2):e.rhs[q]}a.label=e.rhs.join();var d={};d.from=o.id;d.to=a.id;d.arrows="from";if(!p[o.id]){n.push(o)}if(!p[a.id]){n.push(a)}b.push(d);p[o.id]=true;p[a.id]=true}p=null;for(var y=0;y<g.length;y++){var e=g[y];f+="<tr><td>"+e.lhs.join()+"</td><td>"+e.rhs.join()+"</td><td>"+e.confidence+"</td></tr>"}f+"</tbody></table><br><br><br>";var m="<table id='freq-table' class='table'><thead><tr><th>Item</th><th>Support</th></tr></thead><tbody>";for(var y in r){var v=r[y];for(var u=0;u<v.length;u++){var s=v[u];var l=s.itemSet.join();var h=s.support;m+="<tr><td>"+l+"</td><td>"+h+"</td></tr>"}}m+="</tbody></table>";var c={};var w={nodes:n,edges:b};var k=document.getElementById("apriori-table");k.style.width="900px";k.style.height="900px";var x=new vis.Network(k,w,c);x.on("afterDrawing",function(i){logApriori()})};function parseTrainSet(c){var b=c.target.files[0];if(b){showLoader();var a=new FileReader();a.onload=function(f){var d=f.target.result;try{d=d.replace("\n","");JSON.parseAsync(d,function(e){var g=e;fetchDataSet(g);initOptions(g);$(".analysis-tools").show();$("#settings-div").fadeIn();hideLoader()})}catch(f){alert("Not in a proper JSON-format.");return}};a.readAsText(b)}else{alert("Error while loading the input file.")}}function initOptions(a){showLoader();generateAttributeCheckboxes(a[0]);generateGroupBySelect(a);initTimePicker("#start-time","#end-time");generateUserList(a);hideLoader()}function initNeuralNTreeSettings(){var b=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;var a=getMinMax(b);var c=getInputVector(b[0]).length;if(!analysisObjects.miners.neuralNTreeSettings){analysisObjects.miners.neuralNTreeSettings={}}analysisObjects.miners.neuralNTreeSettings.min=a.min;analysisObjects.miners.neuralNTreeSettings.max=a.max;analysisObjects.miners.neuralNTreeSettings.dimensions=c}function getHeaders(d){var b=analysisObjects.miners.ignoredAttributes;var c=[];for(var a in d){if(!(a in b)&&!isNaN(d[a])){c.push(a)}}return c}function getHeadersText(d){var b=analysisObjects.miners.ignoredAttributes;var c=[];for(var a in d){if(!(a in b)){c.push(a)}}return c}function getMinMax(b){var g=analysisObjects.miners.ignoredAttributes;var c={};var f,a;for(var e=0;e<b.length;e++){var h=b[e];for(var d in h){if(!(d in g)&&!isNaN(h[d])){if(!f){f=h[d]}if(!a){a=h[d]}if(f>h[d]){f=h[d]}if(a<h[d]){a=h[d]}}}}c.min=f;c.max=a;return c}function getDimensions(d){var c=analysisObjects.miners.ignoredAttributes;var a=0;for(var b in d){if(!(b in c)&&!isNaN(d[b])){a++}}return a}function getInputVector(d){var c=analysisObjects.miners.ignoredAttributes;var a=[];for(var b in d){if(!(b in c)&&!isNaN(d[b])){a.push(parseFloat(d[b]))}}return a}function getInputVectorText(d){var c=analysisObjects.miners.ignoredAttributes;var a=[];for(var b in d){if(!(b in c)){a.push(d[b])}}return a}function getInputVectorTextAllAttributes(c){var a=[];for(var b in c){if(b!=="timestamp"&&b!=="hiddenId"&&b!=="wellPerformed"&&b!=="anomaly"){a.push(c[b])}else{if(b==="timestamp"){a.push(new Date(+c[b]).toString())}}}return a}function getKeysAllAttributes(c){var b=[];for(var a in c){if(a!=="hiddenId"&&a!=="wellPerformed"&&a!=="anomaly"){b.push(a)}}return b}function getInputVectorTextKey(d){var c=analysisObjects.miners.ignoredAttributes;var a=[];for(var b in d){if(!(b in c)){a.push(b+": "+d[b])}}return a}function generateUserList(b){$("#users").html("");var c={};for(var e=0;e<b.length;e++){var g=b[e];if(g.users){c[g.users]=g.status?g.status:0}}var a="<ul id='user-list'>";var f=0;for(var d in c){var h=c[d]==1?"user-good":c[d]==0?"user-medium":"user-bad";a+="<li onclick='sendMessage(this);' class='ui-state-default "+h+"' id='user-list_"+d+"'>"+d+"</li>";f++}a+="</ul>";$("#users").html(a);$("#user-list").sortable();setMessage(f+" users found")}function sendMessage(b){var a=b.id.split("_")[1];bootbox.prompt({title:"Send a message to "+a,inputType:"textarea",callback:function(c){var d=c;var e=window.sessionStorage.getItem("sessionId");if(d){$.ajax({type:"POST",url:"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_student_message.php",data:"user="+a+"&message="+d+"&sessionId="+e,success:function(f){setMessage("Message has been sent to "+a)},error:function(f){alert("Error while sending a message.")}})}}})}function initTimePicker(){$("#datetimepicker6").datetimepicker();$("#datetimepicker7").datetimepicker({useCurrent:false});$("#datetimepicker6").on("dp.change",function(c){$("#datetimepicker7").data("DateTimePicker").minDate(c.date);var a="start-time";var b=reduceDataSetBasedOnTime(c.date._d,a);if(b){analysisObjects.miners.reducedTimeDataSet=b;analysisObjects.miners.curDataSet=null;generateAttributeTable(analysisObjects.miners.reducedTimeDataSet)}});$("#datetimepicker7").on("dp.change",function(c){$("#datetimepicker6").data("DateTimePicker").maxDate(c.date);var a="end-time";var b=reduceDataSetBasedOnTime(c.date._d,a);if(b){analysisObjects.miners.reducedTimeDataSet=b;analysisObjects.miners.curDataSet=null;generateAttributeTable(analysisObjects.miners.reducedTimeDataSet)}})}function generateAttributeCheckboxes(b){$("#attributes").html("");var c="<h3>Features included</h3><div>";for(var a in b){if(a==="hiddenId"){continue}if(a!=="id"&&a!=="vector_id"&&a!=="session_id"&&a!=="users"&&a!=="timestamp"){c+="<br><input type='checkbox' class='us-attribute-box' id='us-attribute-box_"+a+"' checked>"+a}else{c+="<br><input type='checkbox' class='us-attribute-box' id='us-attribute-box_"+a+"'>"+a}}c+="</div></div>";$("#attributes").html(c);$(".us-attribute-box").on("change",function(f){var e=$("#"+f.target.id).is(":checked");var d=f.target.id.split("_");var g="";d.shift();d=d.join("_");if(!e){analysisObjects.miners.ignoredAttributes[d]=true}else{delete analysisObjects.miners.ignoredAttributes[d]}new initCharts();initNeuralNTreeSettings()})}function resetMiners(){for(var a in analysisObjects.miners){if(analysisObjects.miners[a]&&"undefined"!==typeof analysisObjects.miners[a].reset){analysisObjects.miners[a].reset()}}analysisObjects.miners.classificationWellPerformed={};setMessage("Miners have been reseted")}function generateAttributeTable(a){for(var e=0;e<a.length;e++){a[e]["hiddenId"]=e;a[e]["anomaly"]=0;a[e]["wellPerformed"]=-2}$("#data-set-table").html("");var g="<table id='attribute-table' class='table'><thead><tr>";for(var d in a[0]){if(d!=="anomaly"&&d!=="hiddenId"&&d!=="wellPerformed"){g+="<th>"+d+"</th>"}}g+="<th>Predict</th>";g+="<th>Anomaly</th>";g+="</tr></thead><tbody>";for(var e=0;e<a.length;e++){g+="<tr class='well-performed' id='"+a[e]["hiddenId"]+"'>";for(var d in a[e]){if(d!=="users"&&d!=="anomaly"&&d!=="hiddenId"&&d!=="wellPerformed"&&d!=="timestamp"&&d!=="notes"){f=a[e][d];if(!isNaN(f)&&f!==null){f=parseFloat(f);f=+f.toFixed(2);g+="<td>"+f+"</td>"}else{g+="<td>"+f+"</td>"}}else{if(d==="notes"){var f=a[e]["notes"];if(!f){f=0}g+="<td><input style='width: 30px;' type='text' value='"+f+"' id='notes-"+a[e]["hiddenId"]+"' class='notes'></td>"}else{if(d==="timestamp"){var c=new Date(parseInt(a[e][d]));var b=c.toString();g+="<td>"+b+"</td>"}else{if(d==="users"){g+="<td><button class='btn btn-link' onclick='generateTimeLine(this)' id='timeline-"+a[e]["hiddenId"]+"'>"+a[e][d]+"</button></td>"}}}}}g+="<td><select id='option-"+a[e]["hiddenId"]+"' onchange='selectPerformance(this);'><option value='-2' selected='selected'>Not included</option><option value='-1'>Not performing well</option><option value='0'>Neutral</option><option value='1'>Performing well</option></select></td>";g+="<td><select id='anomaly-"+a[e]["hiddenId"]+"' onchange='selectAnomaly(this);'><option value='0' selected='selected'>Not included</option><option value='1'>Not an anomaly</option><option value='-1'>Anomaly</option>";g+="</tr>"}g+="</tbody></table>";$("#data-set-table").html(g);$("#attribute-table").tablesorter();$(".notes").on("change",function(j){var k=j.target.value;var l=j.target.id.split("-")[1];for(var h=0;h<analysisObjects.miners.dataSet.length;h++){if(analysisObjects.miners.dataSet[h].hiddenId===parseInt(l)){analysisObjects.miners.dataSet[h].notes=parseFloat(k);break}}})}function selectPerformance(b){var d=b.id.split("-")[1];var c=b.value;var e=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;for(var a=0;a<e.length;a++){if(e[a]["hiddenId"]==d){e[a]["wellPerformed"]=c;break}}}function selectAnomaly(b){var d=b.id.split("-")[1];var c=b.value;var e=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;for(var a=0;a<e.length;a++){if(e[a]["hiddenId"]==d){e[a]["anomaly"]=c;break}}}function groupBy(f,k){var l=analysisObjects.miners.ignoredAttributes;var a=[];var m={};for(var e=0;e<f.length;e++){var n=f[e];var b=n[k];if(!m[b]){m[b]={};for(var h in n){if(h!==k){m[b][h]=[];m[b][h].push(n[h])}else{m[b][h]=[];m[b][h].push(b)}}}else{for(var h in n){if(h!==k){if(m[b][h]){m[b][h].push(n[h])}}}}}for(var h in m){a.push(m[h])}for(var e=0;e<a.length;e++){var d=a[e];for(var h in d){var g=0;for(var c=0;c<d[h].length;c++){if(!isNaN(d[h][c])){g+=parseFloat(d[h][c])}}g=d[h].length>0?g/d[h].length:0;a[e][h]=(h==="id"||h in l||h==="users")?d[h][0]:g}}return a}function groupBySum(f,k){var l=analysisObjects.miners.ignoredAttributes;var a=[];var m={};for(var e=0;e<f.length;e++){var n=f[e];var b=n[k];if(!m[b]){m[b]={};for(var h in n){if(h!==k){m[b][h]=[];m[b][h].push(n[h])}else{m[b][h]=[];m[b][h].push(b)}}}else{for(var h in n){if(h!==k){if(m[b][h]){m[b][h].push(n[h])}}}}}for(var h in m){a.push(m[h])}for(var e=0;e<a.length;e++){var d=a[e];for(var h in d){var g=0;for(var c=0;c<d[h].length;c++){if(!isNaN(d[h][c])){g+=parseFloat(d[h][c])}}a[e][h]=(h==="id"||h in l||h==="users")?d[h][0]:g}}return a}function normalize(c,h){var j=analysisObjects.miners.ignoredAttributes;var f=[];for(var b=0;b<c.length;b++){var d={};var a=c[b][h];var e=c[b][h];for(var g in c[b]){if(g!==h&&g!=="id"&&!(g in j)){d[g]=c[b][g]/e}else{if(g==="id"){d.id=c[b]["id"]}else{if(g in j){d[g]=c[b][g]}}}}f.push(d)}return f}function generateGroupBySelect(a){window.sessionStorage.setItem("groupBy","average");var b="<h3>Display grouping by</h3><br><div class='radio'><label><input type='radio' name='group-by-results' value='average' checked>By average</label><br><label><input type='radio' name='group-by-results' value='sum'>By sum</label></div><br><h3>Group by</h3><div class='radio'>";b+="<br><label><input type='radio' name='group-by-radio' id='radio_no-group' value='no-group' checked> No groupping </label>";for(var c in a[0]){if(c!=="users"){continue}if(c==="hiddenId"){continue}b+="<br><label><input type='radio' name='group-by-radio' id='radio_"+c+"'value='"+c+"'>"+c+"</label>"}b+="</div>";$("#group-by").html(b);$("input[type=radio][name=group-by-results]").on("change",function(){var e=$(this).val();window.sessionStorage.setItem("groupBy",e);e=$("input[type=radio][name=group-by-radio]:checked").val();if(e!=="no-group"){var d=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;if(window.sessionStorage.getItem("groupBy")==="average"){analysisObjects.miners.groupDataSet=groupBy(d,e)}else{analysisObjects.miners.groupDataSet=groupBySum(d,e)}generateAttributeTable(analysisObjects.miners.groupDataSet);$("#normalize").show()}else{analysisObjects.miners.curDataSet=null;analysisObjects.miners.groupDataSet=null;var d=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;analysisObjects.miners.groupDataSet=null;$("#normalize").hide();generateAttributeTable(d)}});$("input[type=radio][name=group-by-radio]").on("change",function(){var e=$(this).val();if(e!=="no-group"){var d=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;if(window.sessionStorage.getItem("groupBy")==="average"){analysisObjects.miners.groupDataSet=groupBy(d,e)}else{analysisObjects.miners.groupDataSet=groupBySum(d,e)}generateAttributeTable(analysisObjects.miners.groupDataSet);window.sessionStorage.setItem("groupped",true);$("#normalize").show()}else{analysisObjects.miners.curDataSet=null;analysisObjects.miners.groupDataSet=null;var d=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;analysisObjects.miners.groupDataSet=null;$("#normalize").hide();generateAttributeTable(d);window.sessionStorage.setItem("groupped",false)}})}function generateNormalize(b){var a="<h3>Percentage of the features by</h3><div class='radio'>";a+="<br><label><input type='radio' name='normalize-radio' id='normalize_no-normalize' value='no-normalize' checked> No normalizing </label>";for(var c in b[0]){if(c==="hiddenId"){continue}a+="<br><label><input type='radio' name='normalize-radio' id='normalize_"+c+"'value='"+c+"'>"+c+"</label>"}a+="</div>";$("#normalize").html(a);$("#normalize").hide();$("input[type=radio][name=normalize-radio]").on("change",function(){if(!analysisObjects.miners.groupDataSet){alert("Grouping has to be made before normalizing");return}var d=$(this).val();if(d!=="no-normalize"){analysisObjects.miners.curDataSet=normalize(analysisObjects.miners.groupDataSet,d)}else{analysisObjects.miners.curDataSet=analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet}generateAttributeTable(analysisObjects.miners.curDataSet);initNeuralNTreeSettings()})}function convertMillisToDate(d){var b=new Date(d);var a=b.getHours();var e=(a>=12)?"PM":"AM";a=(a>12)?a-12:a;a=(a=="00")?12:a;var c=b.getMinutes();c=c<=9?"0"+c:c;return a+":"+c+" "+e}function reduceDataSetBasedOnTime(l,j){var e=function(i){return i.getMinutes()+i.getHours()*60};var d=l;if(!l){analysisObjects.miners.reducedTimeDataSet=null;generateAttributeTable(analysisObjects.miners.dataSet);if(j==="start-time"){analysisObjects.miners.minTime=null}else{if(j==="end-time"){analysisObjects.miners.maxTime=null}}return}switch(j){case"start-time":analysisObjects.miners.minTime=d;break;case"end-time":analysisObjects.miners.maxTime=d;break}if(analysisObjects.miners.minTime||analysisObjects.miners.maxTime){var b,k;if(analysisObjects.miners.minTime){b=analysisObjects.miners.minTime}if(analysisObjects.miners.maxTime){k=analysisObjects.miners.maxTime}if(b>k){alert("Start time filter larger than end time filter");return}var a=[];var h=analysisObjects.miners.curDataSet||analysisObjects.miners.dataSet;for(var g=0;g<h.length;g++){var f=h[g];var c=f.timestamp;if(!c){c=f.time}var m=new Date(parseInt(c));if(b&&k&&m>=b&&m<=k){a.push(f)}else{if(b&&!k&&m>=b){a.push(f)}else{if(!b&&k&&m<=k){a.push(f)}}}}return a}return null}function pointChange(d){var f=d.id;var e=$("#"+f).val();var c=f.split("_")[2];var b=f.split("_")[1];var a=parseFloat(e);analysisObjects.miners.neuralNTree.neuralNTree.nodes[c].point[b]=a;$("#"+f).val(e)}function fetchDataSet(c){if(!analysisObjects.miners.dataSet||analysisObjects.miners.dataSet.length===0){analysisObjects.miners.dataSet=[]}var b=0;for(;b<c.length;b++){analysisObjects.miners.dataSet.push(c[b])}for(var a=0;a<analysisObjects.miners.dataSet.length;a++){analysisObjects.miners.dataSet[a]["notes"]=0}generateAttributeTable(analysisObjects.miners.dataSet);initNeuralNTreeSettings();$("input[type=radio][name=group-by-results]").trigger("change");setMessage(b+" data instances loaded")}function setMessage(){var b="";for(var a=0;a<arguments.length;a++){b+="<div class='alert alert-success alert-dismissable text-center'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+arguments[a]+"</div>"}$("#messages").append(b);$(".alert").slideUp(2000)}function showLoader(){$("#loader").show()}function hideLoader(){$("#loader").hide()}function buildStudentModels(){var a=new DecisionTree();var m;try{m=new Anomaly()}catch(n){}var f=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;var b=[];for(var h=0;h<f.length;h++){b.push({users:f[h].users,sessionId:window.sessionStorage.getItem("sessionId"),status:parseInt(a.decisionTree.predict(f[h]))===1?1:parseInt(a.decisionTree.predict(f[h]))===0?0:-1});var l=parseInt(a.decisionTree.predict(f[h]))===1?"wellPerformed":parseInt(a.decisionTree.predict(f[h]))===0?"Medium":"NotWellPerformed";var g="users="+f[h].users+"&sessionId="+window.sessionStorage.getItem("sessionId")+"&classification="+l;$.ajax({type:"POST",url:"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_classification_vectors_pilot_2.php",data:g,success:function(e){},error:function(e){}})}if(m){for(var h=0;h<f.length;h++){var d=parseInt(m.anomaly.predict(f[h]));d=d===1?-1:1;for(var c=0;c<b.length;c++){if(b[c].users===f[h].users){var l=d===1?0:1;$.ajax({type:"POST",url:"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_anomaly_vectors_pilot_2.php",data:"users="+f[h].users+"&sessionId="+window.sessionStorage.getItem("sessionId")+"&anomalies="+l,success:function(e){},error:function(e){}});b[c].status+=d}}}}function p(j,u){var t={};for(var r=0,e=j.length;r<e;r++){if(!t[j[r][u]]){t[j[r][u]]=j[r]}}var s=[];for(var q in t){s.push(t[q])}return s}b=p(b,"users");var o=-Infinity;for(var h=0;h<b.length;h++){if(b[h].status>o){o=b[h].status}}for(var h=0;h<b.length;h++){var k=b[h];var d=100-Math.floor(Math.abs(o-k.status));var g="users="+k.users+"&sessionId="+k.sessionId+"&status="+d;$.ajax({method:"POST",url:"http://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_student_models_pilot_2.php",data:g,success:function(e){},error:function(e){}})}a.reset();if(m){m.reset()}}function Reflect(){analysisObjects.uiConstants.removeContent();this.createUI()}Reflect.prototype.createUI=function(){var b=$(analysisObjects.uiConstants.wrapper);showLoader();var a=isChrome()?analysisObjects.urls.templateUrl+"options.html":"templates/options.html";b.load(a,function(){hideLoader()})};function generateTimeLine(d){var b=d.id.split("-")[1];var h="";for(var k=0;k<analysisObjects.miners.dataSet.length;k++){if(analysisObjects.miners.dataSet[k].hiddenId==b){h=analysisObjects.miners.dataSet[k].users;break}}var m=[];for(var k=0;k<analysisObjects.miners.dataSet.length;k++){if(analysisObjects.miners.dataSet[k].users==h){m.push(analysisObjects.miners.dataSet[k])}}var g=[];for(var k=0;k<m.length;k++){var f=m[k];var e=null;for(var l in f){if(l==="timestamp"||l==="wellPerformed"||l==="hiddenId"||l==="users"){continue}if(f[l]){e=l}}var j={};j.id=f.hiddenId;j.content=e;var a=parseInt(f.timestamp);var c=new Date(a);j.start=c.toString();g.push(j)}g.sort(function(n,i){return new Date(n.start)-new Date(i.start)});$("<div id='timeline-dialog-"+b+"'></div>").dialog({width:650,height:600});new vis.Timeline(document.getElementById("timeline-dialog-"+b),g,{})};