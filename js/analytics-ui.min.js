"use strict"
function initSettings(){analysisObjects.uiConstants.removeContent(),this.settings=analysisObjects.miners.settings||new Settings,this.createUI()}function initCluster(){analysisObjects.uiConstants.removeContent(),initNeuralNTreeSettings(),this.settings=analysisObjects.miners.neuralNTreeSettings||null,this.neuralNTree=analysisObjects.miners.neuralNTree||null,this.createUI()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function initClassification(){analysisObjects.uiConstants.removeContent(),this.classification=analysisObjects.miners.decisionTree||new DecisionTree,this.createUI()}function initAnomaly(){analysisObjects.uiConstants.removeContent(),this.createUI()}function initCharts(){this.createUI()}function initApriori(){analysisObjects.uiConstants.removeContent(),this.createUI()}function parseTrainSet(e){var t=e.target.files[0]
if(t){showLoader()
var a=new FileReader
a.onload=function(e){var t=e.target.result
try{t=t.replace("\n",""),JSON.parseAsync(t,function(e){var t=e
fetchDataSet(t),initOptions(t),$(".analysis-tools").show(),$("#settings-div").fadeIn(),hideLoader()})}catch(e){return alert("Not in a proper JSON-format."),void console.log(e)}},a.readAsText(t)}else alert("Error while loading the input file.")}function initOptions(e){showLoader(),generateAttributeCheckboxes(e[0]),generateGroupBySelect(e),initTimePicker("#start-time","#end-time"),generateUserList(e),hideLoader()}function initNeuralNTreeSettings(){var e=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,t=getMinMax(e),a=getInputVector(e[0]).length
analysisObjects.miners.neuralNTreeSettings||(analysisObjects.miners.neuralNTreeSettings={}),analysisObjects.miners.neuralNTreeSettings.min=t.min,analysisObjects.miners.neuralNTreeSettings.max=t.max,analysisObjects.miners.neuralNTreeSettings.dimensions=a}function getHeaders(e){var t=analysisObjects.miners.ignoredAttributes,a=[]
for(var s in e)s in t||isNaN(e[s])||a.push(s)
return a}function getHeadersText(e){var t=analysisObjects.miners.ignoredAttributes,a=[]
for(var s in e)s in t||a.push(s)
return a}function getMinMax(e){for(var t,a,s=analysisObjects.miners.ignoredAttributes,r={},i=0;i<e.length;i++){var n=e[i]
for(var l in n)l in s||isNaN(n[l])||(t||(t=n[l]),a||(a=n[l]),t>n[l]&&(t=n[l]),a<n[l]&&(a=n[l]))}return r.min=t,r.max=a,r}function getDimensions(e){var t=analysisObjects.miners.ignoredAttributes,a=0
for(var s in e)s in t||isNaN(e[s])||a++
return a}function getInputVector(e){var t=analysisObjects.miners.ignoredAttributes,a=[]
for(var s in e)s in t||isNaN(e[s])||a.push(parseFloat(e[s]))
return a}function getInputVectorText(e){var t=analysisObjects.miners.ignoredAttributes,a=[]
for(var s in e)s in t||a.push(e[s])
return a}function getInputVectorTextAllAttributes(e){var t=[]
for(var a in e)"hiddenId"!==a&&"wellPerformed"!==a&&t.push(e[a])
return t}function getKeysAllAttributes(e){var t=[]
for(var a in e)"hiddenId"!==a&&"wellPerformed"!==a&&t.push(a)
return t}function getInputVectorTextKey(e){var t=analysisObjects.miners.ignoredAttributes,a=[]
for(var s in e)s in t||a.push(s+": "+e[s])
return a}function generateUserList(e){$("#users").html("")
for(var t={},a=0;a<e.length;a++){var s=e[a]
s.users&&(t[s.users]=s.status?s.status:0)}var r="<ul id='user-list'>",i=0
for(var n in t){r+="<li class='ui-state-default "+(1==t[n]?"user-good":0==t[n]?"user-medium":"user-bad")+"' id='user-list_"+n+"'>"+n+"</li>",i++}r+="</ul>",$("#users").html(r),$("#user-list").sortable(),setMessage(i+" users found")}function initTimePicker(){for(var e=0;e<arguments.length;e++)$(arguments[e]).timepicker({interval:5,change:function(e){var t=$(this).attr("id"),a=reduceDataSetBasedOnTime(e,t)
a&&(analysisObjects.miners.reducedTimeDataSet=a,analysisObjects.miners.curDataSet=null,generateAttributeTable(analysisObjects.miners.reducedTimeDataSet))}})}function generateAttributeCheckboxes(e){$("#attributes").html("")
var t="<h3>Features included</h3><div>"
for(var a in e)"hiddenId"!==a&&(t+="id"!==a&&"vector_id"!==a&&"session_id"!==a&&"users"!==a&&"timestamp"!==a?"<br><input type='checkbox' class='us-attribute-box' id='us-attribute-box_"+a+"' checked>"+a:"<br><input type='checkbox' class='us-attribute-box' id='us-attribute-box_"+a+"'>"+a)
t+="</div></div>",$("#attributes").html(t),$(".us-attribute-box").on("change",function(e){var t=$("#"+e.target.id).is(":checked"),a=e.target.id.split("_")
a.shift(),a=a.join("_"),t?delete analysisObjects.miners.ignoredAttributes[a]:analysisObjects.miners.ignoredAttributes[a]=!0,new initCharts,initNeuralNTreeSettings()})}function resetMiners(){for(var e in analysisObjects.miners)analysisObjects.miners[e]&&void 0!==analysisObjects.miners[e].reset&&analysisObjects.miners[e].reset()
analysisObjects.miners.classificationWellPerformed={},setMessage("Miners have been reseted")}function generateAttributeTable(e){for(var t=0;t<e.length;t++)e[t].hiddenId=t
$("#data-set-table").html("")
var a="<table id='attribute-table' class='table'><thead><tr>"
for(var s in e[0])"hiddenId"!==s&&"wellPerformed"!==s&&(a+="<th>"+s+"</th>")
a+="<th>Options</th>",a+="</tr></thead><tbody>"
for(var t=0;t<e.length;t++){a+="<tr class='well-performed' id='"+e[t].hiddenId+"'>"
for(var s in e[t])"hiddenId"!==s&&"wellPerformed"!==s&&(a+="<td>"+e[t][s]+"</td>")
a+="<td><select id='option-"+e[t].hiddenId+"' onchange='selectPerformance(this);'><option value='-2' selected='selected'>Not included</option><option value='-1'>Not performing well</option><option value='0'>Neutral</option><option value='1'>Performing well</option></select></td>",a+="</tr>"}a+="</tbody></table>",$("#data-set-table").html(a),$("#attribute-table").tablesorter(),new initCharts}function selectPerformance(e){for(var t=e.id.split("-")[1],a=e.value,s=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,r=0;r<s.length;r++)if(s[r].hiddenId==t){s[r].wellPerformed=a
break}}function groupBy(e,t){for(var a=analysisObjects.miners.ignoredAttributes,s=[],r={},i=0;i<e.length;i++){var n=e[i],l=n[t]
if(r[l])for(var o in n)o!==t&&r[l][o]&&r[l][o].push(n[o])
else{r[l]={}
for(var o in n)o!==t?(r[l][o]=[],r[l][o].push(n[o])):(r[l][o]=[],r[l][o].push(l))}}for(var o in r)s.push(r[o])
for(var i=0;i<s.length;i++){var u=s[i]
for(var o in u){for(var c=0,d=0;d<u[o].length;d++)isNaN(u[o][d])||(c+=parseFloat(u[o][d]))
c=u[o].length>0?c/u[o].length:0,s[i][o]="id"===o||o in a||"users"===o?u[o][0]:c}}return s}function groupBySum(e,t){for(var a=analysisObjects.miners.ignoredAttributes,s=[],r={},i=0;i<e.length;i++){var n=e[i],l=n[t]
if(r[l])for(var o in n)o!==t&&r[l][o]&&r[l][o].push(n[o])
else{r[l]={}
for(var o in n)o!==t?(r[l][o]=[],r[l][o].push(n[o])):(r[l][o]=[],r[l][o].push(l))}}for(var o in r)s.push(r[o])
for(var i=0;i<s.length;i++){var u=s[i]
for(var o in u){for(var c=0,d=0;d<u[o].length;d++)isNaN(u[o][d])||(c+=parseFloat(u[o][d]))
s[i][o]="id"===o||o in a||"users"===o?u[o][0]:c}}return s}function normalize(e,t){for(var a=analysisObjects.miners.ignoredAttributes,s=[],r=0;r<e.length;r++){var i={},n=(e[r][t],e[r][t])
for(var l in e[r])l===t||"id"===l||l in a?"id"===l?i.id=e[r].id:l in a&&(i[l]=e[r][l]):i[l]=e[r][l]/n
s.push(i)}return s}function generateGroupBySelect(e){window.sessionStorage.setItem("groupBy","average")
var t="<h3>Display grouping by</h3><br><div class='radio'><label><input type='radio' name='group-by-results' value='average' checked>By average</label><br><label><input type='radio' name='group-by-results' value='sum'>By sum</label></div><br><h3>Group by</h3><div class='radio'>"
t+="<br><label><input type='radio' name='group-by-radio' id='radio_no-group' value='no-group' checked> No groupping </label>"
for(var a in e[0])"users"===a&&"hiddenId"!==a&&(t+="<br><label><input type='radio' name='group-by-radio' id='radio_"+a+"'value='"+a+"'>"+a+"</label>")
t+="</div>",$("#group-by").html(t),$("input[type=radio][name=group-by-results]").on("change",function(){var e=$(this).val()
if(window.sessionStorage.setItem("groupBy",e),"no-group"!==(e=$("input[type=radio][name=group-by-radio]:checked").val())){var t=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet
"average"===window.sessionStorage.getItem("groupBy")?analysisObjects.miners.groupDataSet=groupBy(t,e):analysisObjects.miners.groupDataSet=groupBySum(t,e),generateAttributeTable(analysisObjects.miners.groupDataSet),$("#normalize").show()}else{analysisObjects.miners.curDataSet=null,analysisObjects.miners.groupDataSet=null
var t=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet
analysisObjects.miners.groupDataSet=null,$("#normalize").hide(),generateAttributeTable(t)}}),$("input[type=radio][name=group-by-radio]").on("change",function(){var e=$(this).val()
if("no-group"!==e){var t=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet
"average"===window.sessionStorage.getItem("groupBy")?analysisObjects.miners.groupDataSet=groupBy(t,e):analysisObjects.miners.groupDataSet=groupBySum(t,e),generateAttributeTable(analysisObjects.miners.groupDataSet),window.sessionStorage.setItem("groupped",!0),$("#normalize").show()}else{analysisObjects.miners.curDataSet=null,analysisObjects.miners.groupDataSet=null
var t=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet
analysisObjects.miners.groupDataSet=null,$("#normalize").hide(),generateAttributeTable(t),window.sessionStorage.setItem("groupped",!1)}})}function generateNormalize(e){var t="<h3>Percentage of the features by</h3><div class='radio'>"
t+="<br><label><input type='radio' name='normalize-radio' id='normalize_no-normalize' value='no-normalize' checked> No normalizing </label>"
for(var a in e[0])"hiddenId"!==a&&(t+="<br><label><input type='radio' name='normalize-radio' id='normalize_"+a+"'value='"+a+"'>"+a+"</label>")
t+="</div>",$("#normalize").html(t),$("#normalize").hide(),$("input[type=radio][name=normalize-radio]").on("change",function(){if(!analysisObjects.miners.groupDataSet)return void alert("Grouping has to be made before normalizing")
var e=$(this).val()
analysisObjects.miners.curDataSet="no-normalize"!==e?normalize(analysisObjects.miners.groupDataSet,e):analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,generateAttributeTable(analysisObjects.miners.curDataSet),initNeuralNTreeSettings()})}function convertMillisToDate(e){var t=new Date(e),a=t.getHours(),s=a>=12?"PM":"AM"
a=a>12?a-12:a,a="00"==a?12:a
var r=t.getMinutes()
return r=r<=9?"0"+r:r,a+":"+r+" "+s}function reduceDataSetBasedOnTime(e,t){var a=function(e){return e.getMinutes()+60*e.getHours()},s=new Date(e)
if(!e)return analysisObjects.miners.reducedTimeDataSet=null,generateAttributeTable(analysisObjects.miners.dataSet),void("start-time"===t?analysisObjects.miners.minTime=null:"end-time"===t&&(analysisObjects.miners.maxTime=null))
switch(t){case"start-time":analysisObjects.miners.minTime=s
break
case"end-time":analysisObjects.miners.maxTime=s}if(analysisObjects.miners.minTime||analysisObjects.miners.maxTime){var r,i
if(analysisObjects.miners.minTime&&(r=a(analysisObjects.miners.minTime)),analysisObjects.miners.maxTime&&(i=a(analysisObjects.miners.maxTime)),r>i)return void alert("Start time filter larger than end time filter")
for(var n=[],l=analysisObjects.miners.curDataSet||analysisObjects.miners.dataSet,o=0;o<l.length;o++){var u=l[o],c=new Date,d=u.timestamp
if(d||(d=u.time),d.indexOf("PM")>-1)var p=!0
else var p=!1
d=d.replace("AM",""),d=d.replace("PM",""),d=d.split(":")
var h=parseInt(d[1]),m=p?parseInt(d[0])+12:parseInt(d[0])
c.setHours(m),c.setMinutes(h),c=a(c),r&&i&&c>=r&&c<=i?n.push(u):r&&!i&&c>=r?n.push(u):!r&&i&&c<=i&&n.push(u)}return n}return null}function pointChange(e){var t=e.id,a=$("#"+t).val(),s=t.split("_")[2],r=t.split("_")[1],i=parseFloat(a)
analysisObjects.miners.neuralNTree.neuralNTree.nodes[s].point[r]=NNTFunctions.util.convertRange([i],[analysisObjects.miners.neuralNTree.neuralNTree.min,analysisObjects.miners.neuralNTree.neuralNTree.max],[-2,2]),$("#"+t).val(a)}function fetchDataSet(e){analysisObjects.miners.dataSet&&0!==analysisObjects.miners.dataSet.length||(analysisObjects.miners.dataSet=[])
for(var t=0;t<e.length;t++)analysisObjects.miners.dataSet.push(e[t])
if(analysisObjects.miners.dataSet[0].timestamp)for(var t=0;t<analysisObjects.miners.dataSet.length;t++)isNaN(analysisObjects.miners.dataSet[t].timestamp)||(analysisObjects.miners.dataSet[t].timestamp=convertMillisToDate(parseInt(analysisObjects.miners.dataSet[t].timestamp)))
generateAttributeTable(analysisObjects.miners.dataSet),initNeuralNTreeSettings(),$("input[type=radio][name=group-by-results]").trigger("change"),setMessage(t+" data instances loaded")}function setMessage(){for(var e="",t=0;t<arguments.length;t++)e+="<div class='alert alert-info alert-dismissable text-center'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+arguments[t]+"</div>"
$("#messages").append(e)}function showLoader(){$("#loader").show()}function hideLoader(){$("#loader").hide()}function buildStudentModels(){var e,t=new DecisionTree
try{e=new Anomaly}catch(e){}for(var a=analysisObjects.miners.dataSet,s=[],r=0;r<a.length;r++){s.push({users:a[r].users,sessionId:window.sessionStorage.getItem("sessionId"),status:1===parseInt(t.decisionTree.predict(a[r]))?1:0===parseInt(t.decisionTree.predict(a[r]))?0:-1})
var i=1===parseInt(t.decisionTree.predict(a[r]))?"wellPerformed":0===parseInt(t.decisionTree.predict(a[r]))?"Medium":"NotWellPerformed",n="users="+a[r].users+"&sessionId="+window.sessionStorage.getItem("sessionId")+"&classification="+i
$.ajax({type:"POST",url:"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_classification_vectors_pilot_2.php",data:n,success:function(e){console.log(e)},error:function(e){}})}if(e){for(var r=0;r<a.length;r++){for(var l=getInputVector(a[r]),o=0;o<l.length;o++)l[o]=parseFloat(l[o])
for(var o=l.length-1;o>=0;o--)o in e.similar&&l.splice(o,1)
l=$V(l)}for(var u=e.outlier.probs,c=0,r=0;r<u.length;r++)c+=u[r]
u.length>0&&(c/=u.length)
for(var r=0;r<a.length;r++){for(var l=getInputVector(a[r]),o=0;o<l.length;o++)l[o]=parseFloat(l[o])
for(var o=l.length-1;o>=0;o--)o in e.similar&&l.splice(o,1)
l=$V(l)
var d=parseInt(e.outlier.checkIfOutlier(l,c))
d=1===d?-1:1
for(var o=0;o<s.length;o++)if(s[o].users===a[r].users){var i=1===d?0:1
$.ajax({type:"POST",url:"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_anomaly_vectors_pilot_2.php",data:"users="+a[r].users+"&sessionId="+window.sessionStorage.getItem("sessionId")+"&anomalies="+i,success:function(e){},error:function(e){}}),s[o].status+=d}}}s=function(e,t){for(var a={},s=0,r=e.length;s<r;s++)a[e[s][t]]||(a[e[s][t]]=e[s])
var i=[]
for(var n in a)i.push(a[n])
return i}(s,"users")
for(var p=-1/0,r=0;r<s.length;r++)s[r].status>p&&(p=s[r].status)
0==p&&(p=-1)
for(var r=0;r<s.length;r++){var h=s[r],n="users="+h.users+"&sessionId="+h.sessionId+"&status="+Math.floor(h.status/p*100)
$.ajax({method:"POST",url:"http://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_student_models_pilot_2.php",data:n,success:function(){},error:function(e){console.log(e)}})}t.reset(),e&&e.reset()}var analysisObjects=analysisObjects||{}
analysisObjects.miners={neuralNTree:null,neuralNTreeSettings:null,decisionTree:null,decisionTreeSettings:null,anomaly:null,anomalySettings:null,charts:null,chartsSettings:null,settings:null,dataSet:null,curDataSet:null,groupDataSet:null,neuralNTreeHeaders:null,neuralNTreeNotes:null,apriori:null,ignoredAttributes:{id:!0,wellPerformed:!0,hiddenId:!0,vector_id:!0,session_id:!0,users:!0,timestamp:!0},classificationWellPerformed:{},minTime:null,maxTime:null,reducedTimeDataSet:null,resetDatasets:function(){analysisObjects.miners.dataSet=[],analysisObjects.miners.curDataSet=null,analysisObjects.miners.groupDataSet=null,analysisObjects.miners.reducedTimeDataSet=null,analysisObjects.miners.classificationWellPerformed={}}},analysisObjects.uiConstants={wrapper:"#analysis-content",settings:"#analysis-settings",removeContent:function(){$(this.wrapper).html(""),$(this.settings).hide()}},analysisObjects.urls={templateUrl:window.location.href.replace("index.html","")+"templates/",baseUrl:"https:"===location.protocol?"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/":"http://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/"},analysisObjects.dataFetchUrls={snap:analysisObjects.urls.baseUrl+"get_programming_vectors_pilot_2.php",uui:analysisObjects.urls.baseUrl+"get_uui_vectors_pilot_2.php",print:analysisObjects.urls.baseUrl+"get_search_vectors_pilot_2.php",brainstorm:analysisObjects.urls.baseUrl+"get_brainstorm_vectors_pilot_2.php"},analysisObjects.notifyUrls={snap:analysisObjects.urls.baseUrl+"notify_programming.php",uui:analysisObjects.urls.baseUrl+"notify_uui.php",print:analysisObjects.urls.baseUrl+"notify_print.php",brainstorm:analysisObjects.urls.baseUrl+"notify_brainstorm.php"}
var Settings=function(){}
Settings.prototype.reset=function(){analysisObjects.miners.settings=null,this.settings=null},Settings.prototype.save=function(){analysisObjects.miners.settings=this}
var Association=function(e,t,a,s){for(var r=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,i=[],n=0;n<r.length;n++)i.push(getInputVectorTextKey(r[n]))
this.trainingSet=i,this.apriori=new Apriori.Algorithm(e,t,a,s).showAnalysisResultFromFile(this.trainingSet),this.save()}
Association.prototype.save=function(){analysisObjects.miners.apriori=this},Association.prototype.reset=function(){analysisObjects.miners.apriori=null,this.apriori=null}
var NeuralNTree=function(e,t,a,s,r,i){if(analysisObjects.miners.neuralNTree)this.neuralNTree=analysisObjects.miners.neuralNTree.neuralNTree
else{var n={}
n.size=2*e-1,n.dimensions=r,n.learningRate=s,n.scaleMin=t,n.scaleMax=a,this.neuralNTree=new NNTFunctions.NeuralNTree(n),this.save()}}
NeuralNTree.prototype.save=function(){analysisObjects.miners.neuralNTree=this},NeuralNTree.prototype.reset=function(){analysisObjects.miners.neuralNTree=null,analysisObjects.miners.neuralNTreeSettings=null,this.neuralNTree=null}
var DecisionTree=function(){this.data=JSON.parse(JSON.stringify(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet))
for(var e=[],t=this.data.length-1;t>=0;t--)void 0===this.data[t].wellPerformed||-2==this.data[t].wellPerformed?(console.log(this.data[t]),this.data.splice(t,1)):this.data[t].wellPerformed=parseInt(this.data[t].wellPerformed)
for(var t=0;t<this.data.length;t++){var a={}
for(var s in this.data[t])s in analysisObjects.miners.ignoredAttributes&&"wellPerformed"!==s||(isNaN(this.data[t][s])?a[s]=this.data[t][s]:a[s]=parseFloat(this.data[t][s]))
e.push(a)}this.data=e,this.config={trainingSet:this.data,categoryAttr:"wellPerformed"},this.decisionTree=new dt.DecisionTree(this.config),this.save()}
DecisionTree.prototype.save=function(){analysisObjects.miners.decisionTree=this},DecisionTree.prototype.reset=function(){analysisObjects.miners.decisionTree=null,this.decisionTree=null}
var Anomaly=function(){this.outlier=outlier,this.dataSet=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet
for(var e=[],t=0;t<this.dataSet.length;t++){var a=getInputVector(this.dataSet[t])
e.push(a)}this.dataSet=e
for(var t=this.dataSet.length-1;t>=0;t--)for(var s=this.dataSet[t].length-1;s>=0;s--)isNaN(this.dataSet[t][s])?this.dataSet[t].splice(s,1):this.dataSet[t][s]=parseFloat(this.dataSet[t][s])
this.similar={}
for(var r={},t=this.dataSet.length-1;t>=0;t--){for(var s=this.dataSet[t].length-1;s>=0;s--){for(var i=this.dataSet.length-1;i>=0;i--){var n=this.dataSet[i][s]
r[n]?r[n].count++:(r[n]={},r[n].count=1,r[n].index=s)}if(Object.keys(r).length<=1)for(var l in r)this.similar[r[l].index]=!0
r={}}break}for(var t=this.dataSet.length-1;t>=0;t--)for(var s=this.dataSet[t].length-1;s>=0;s--)s in this.similar&&this.dataSet[t].splice(s,1)
if(!this.dataSet[0].length||1===this.dataSet[0].length)throw alert("Not enough diversities in the data to train anomaly detector."),new Error("Not enough diversities")
this.data=$M(this.dataSet),this.outlier.trainClassifer(this.data),this.save()}
Anomaly.prototype.save=function(){analysisObjects.miners.anomaly=this},Anomaly.prototype.reset=function(){this.outlier=null,analysisObjects.miners.anomaly=null}
var Charts=function(){}
initSettings.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.settings)
e.show(),""===e.html()&&e.load("templates/settings.html",function(){})},initCluster.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper),t=this
showLoader()
var a=isChrome()?analysisObjects.urls.templateUrl+"cluster.html":"templates/cluster.html"
e.load(a,function(){t.settings&&(t.settings.size&&$("#max-clusters").val(t.settings.size),t.settings.alpha&&$("#alpha").val(t.settings.alpha),$("#dimensions").val(t.settings.dimensions),$("#min").val(t.settings.min),$("#max").val(t.settings.max)),t.neuralNTree&&t.visualiseNeuralNTree(),$("#forward").on("click",function(e){if(showLoader(),!t.neuralNTree){try{var a=parseInt($("#max-clusters").val()),s=parseFloat($("#alpha").val()),r=parseInt($("#dimensions").val()),i=parseFloat($("#min").val()),n=parseFloat($("#max").val())
0==i&&(i=1e-7),0==n&&(n=1e-7)}catch(e){return void alert("Not a valid Neural N-Tree parameter")}t.neuralNTree=new NeuralNTree(a,i,n,s,r),t.settings={},t.settings.size=a,t.settings.alpha=s,t.settings.dimensions=r,t.settings.min=i,t.settings.max=n,analysisObjects.miners.neuralNTreeSettings=t.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){for(var l=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,o=0;o<l.length;o++)t.neuralNTree.neuralNTree.forwardTrain(getInputVector(l[o]))
t.visualiseNeuralNTree()}else alert("No data set specified")
hideLoader()}),$("#backward").on("click",function(e){if(showLoader(),!t.neuralNTree){try{var a=parseInt($("#max-clusters").val()),s=parseFloat($("#alpha").val()),r=parseInt($("#dimensions").val()),i=parseFloat($("#min").val()),n=parseFloat($("#max").val())
0==i&&(i=1e-7),0==n&&(n=1e-7)}catch(e){return void alert("Not a valid Neural N-Tree parameter")}t.neuralNTree=new NeuralNTree(a,i,n,s,r),t.settings={},t.settings.size=a,t.settings.alpha=s,t.settings.dimensions=r,t.settings.min=i,t.settings.max=n,analysisObjects.miners.neuralNTreeSettings=t.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){for(var l=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,o=0;o<l.length;o++)t.neuralNTree.neuralNTree.backwardTrain(getInputVector(l[o]))
t.visualiseNeuralNTree()}else alert("No data set specified")
hideLoader()}),$("#cluster").on("click",function(e){if(showLoader(),!t.neuralNTree){try{var a=parseInt($("#max-clusters").val()),s=parseFloat($("#alpha").val()),r=parseInt($("#dimensions").val()),i=parseFloat($("#min").val()),n=parseFloat($("#max").val())
0==i&&(i=1e-7),0==n&&(n=1e-7)}catch(e){return void alert("Not a valid Neural N-Tree parameter")}t.neuralNTree=new NeuralNTree(a,i,n,s,r),t.settings={},t.settings.size=a,t.settings.alpha=s,t.settings.dimensions=r,t.settings.min=i,t.settings.max=n,analysisObjects.miners.neuralNTreeSettings=t.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){var l=[],o=Object.assign([],t.lastNodes)
t.nodes.update(o)
for(var u=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,c=0;c<u.length;c++){var d=t.neuralNTree.neuralNTree.cluster(getInputVector(u[c])).index
l[d]||(l[d]=[]),l[d].push(getInputVector(u[c]))
for(var p=u[c],h="",m=0,g=u[c].length;m<g;m++)h+=m<g-1?u[c][m].toFixed(4)+", ":u[c][m].toFixed(4)
var a=t.nodes.get(d).size,v=t.nodes.get(d).info,b=t.nodes.get(d).featureCount,f=t.nodes.get(d).label+""
if(b++,"INPUT"===$(v).prop("tagName")){v=$(v).val(),v="["+v+"]",v=JSON.parse(v)
for(var y="<table class='table' style='width: 100%;'><tr>",O=getHeaders(u[c]),m=0,g=v.length;m<g;m++)y+="<th>"+O[m]+"</th>"
y+="<th>Notes</th>",y+="</tr><tr>",p=getInputVector(p)
for(var m=0;m<p.length;m++)y+="<td>"+p[m]+"</td>"
analysisObjects.miners.neuralNTreeNotes&&analysisObjects.miners.neuralNTreeNotes[c]?y+="<td>"+analysisObjects.miners.neuralNTreeNotes[c]+"</td>":u[c].users?y+="<td>"+u[c].users+"</td>":u[c].id?y+="<td>"+u[c].id+"</td>":y+="<td>No notes</td>",y+="</tr>",y+="</table>"}else{var j=v.substring(0,v.length-8),N="<tr>"
p=getInputVector(p)
for(var m=0,g=p.length;m<g;m++)N+="<td>"+p[m]+"</td>"
analysisObjects.miners.neuralNTreeNotes&&analysisObjects.miners.neuralNTreeNotes[c]?N+="<td>"+analysisObjects.miners.neuralNTreeNotes[c]+"</td>":u[c].users?N+="<td>"+u[c].users+"</td>":u[c].id?N+="<td>"+u[c].id+"</td>":N+="<td>No notes</td>",N+="</tr></table>"
var y=j+N}v+="<br>"+JSON.stringify(p),f=f.split("\n")[0]+"\nn = "+b,a+=.3,t.nodes.update({id:d,size:a,points:t.nodes.get(d).currentPoints+"<hr>"+y,info:y,featureCount:b,label:f})}for(var S=[],c=0;c<l.length;c++)for(var m=0;m<l.length;m++)if(c!==m&&l[c]&&l[m]&&l[c].length>1&&l[m].length>1){var o=t.silhouette(l[c],l[m])
S.push({silhouette:o,cluster:c,"compared cluster":m})}S.sort(function(e,t){return e.silhouette<t.silhouette?-1:e.silhouette>t.silhouette?1:0}),t.createSilhouetteTable(S)}else alert("No data set specified")
hideLoader()}),$("#backward").click(),$("#forward").click(),$("#cluster").click(),$("#reset-cluster").on("click",function(e){t.neuralNTree=null,analysisObjects.miners.neuralNTree&&analysisObjects.miners.neuralNTree.reset(),setMessage("Neural N-Tree has been reseted")}),hideLoader()})},initCluster.prototype.createSilhouetteTable=function(e){var t="<table class='table'><thead><tr>"
for(var a in e[0])t+="<th>"+a+"</th>"
t+="</tr><tbody>"
for(var s=0;s<e.length;s++){t+=e[s].silhouette>0?"<tr class='success'>":"<tr class='danger'>"
for(var a in e[s])t+="<td>"+e[s][a]+"</td>"
t+="</tr>"}t+="</tbody></table>",$("#silhouettes").html(t)},initCluster.prototype.silhouette=function(e,t){this.euclidean=function(e,t){for(var a=0,s=0;s<e.length;s++)a+=(e[s]-t[s])*(e[s]-t[s])
return Math.sqrt(a)}
for(var a=0,s=0,r=0,i=0,n=0;n<e.length;n++){for(var l=0;l<e.length;l++)n!==l&&(a+=this.euclidean(e[n],e[l]),s++)
for(var l=0;l<t.length;l++)r+=this.euclidean(e[n],t[l]),i++}return a/=s,((r/=i)-a)/Math.max(a,r)},initCluster.prototype.visualHypertree=function(){var e=this.neuralNTree.neuralNTree.toJSON(),t=new $jit.Hypertree({injectInto:"neural-n-tree-hyperbolic",width:800,height:800,Node:{dim:9,color:"#f00"},Edge:{lineWidth:2,color:"#088"},onBeforeCompute:function(e){},onCreateLabel:function(e,a){e.innerHTML=a.name,$jit.util.addEvent(e,"click",function(){t.onClick(a.id,{onComplete:function(){for(var e=(a.id.split("_")[0],self.neuralNTree.neuralNTree.levelOrder()),s=0;s<e.length;s++)for(var r=0;r<e[s].length;r++)e[s][r].index
t.controller.onComplete()}})})},onPlaceLabel:function(e,t){var a=e.style
a.display="",a.cursor="pointer",t._depth<=1?(a.fontSize="0.8em",a.color="#ddd"):2==t._depth?(a.fontSize="0.7em",a.color="#555"):a.display="none"
var s=parseInt(a.left),r=e.offsetWidth
a.left=s-r/2+"px"},onComplete:function(){}})
t.loadJSON(e),t.refresh(),t.controller.onComplete(),this.ht=t},initCluster.prototype.visualiseNeuralNTree=function(){var e=this
this.mergeIndices={},this.nodes=new vis.DataSet,this.edges=new vis.DataSet,this.levelCount=0,this.visual&&(this.visual.destroy(),this.visual=null),this.lastNodes=[]
for(var t=this.neuralNTree.neuralNTree.levelOrder(this.neuralNTree.neuralNTree.rootNode),a=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,s=t.length-1;s>=0;s--){for(var r=!1,i=0,n=t[s].length;i<n;i++)null!==t[s][i]&&(r=!0)
r||t.splice(s,1)}for(var l=[],s=0,n=t[0][0].point.length;s<n;s++)l.push(NNTFunctions.util.convertRange([t[0][0].point[s]],[-2,2],[this.neuralNTree.neuralNTree.min,this.neuralNTree.neuralNTree.max])[0])
for(var s=0,n=t.length;s<n;s++)for(var i=0,o=t[s].length;i<o;i++)if(null!==t[s][i])for(var u=0,c=t[s][i].point.length;u<c;u++)l[u]>NNTFunctions.util.convertRange([t[s][i].point[u]],[-2,2],[this.neuralNTree.neuralNTree.min,this.neuralNTree.neuralNTree.max])[0]&&(l[u]=NNTFunctions.util.convertRange([t[s][i].point[u]],[-2,2],[this.neuralNTree.neuralNTree.min,this.neuralNTree.neuralNTree.max])[0]),0==l[u]&&(l[u]=1e-8)
for(var d=null,p=null,s=0,h=t.length;s<h;s++)for(var i=0,o=t[s].length;i<o;i++)if(null!==t[s][i]&&t[s][i]!==this.neuralNTree.neuralNTree.rootNode&&t[s][i]!==this.neuralNTree.neuralNTree.rootNode.left&&t[s][i]!==this.neuralNTree.neuralNTree.rootNode.right){var m=t[s][i].point
m=NNTFunctions.util.convertRange(m,[-2,2],[this.neuralNTree.neuralNTree.min,this.neuralNTree.neuralNTree.max])
var g=NNTFunctions.util.similarity(m,l)
null===d&&(d=g),null===p&&(p=g),d<g&&(d=g),p>g&&(p=g)}this.levelCount=t.length
for(var v=getHeaders(a[0]),s=0,n=t.length;s<n;s++)for(var i=0,b=t[s].length;i<b;i++)if(null!==t[s][i]){for(var f="<input type='text' style='width: 290px;' value='",y=NNTFunctions.util.convertRange(t[s][i].point,[-2,2],[this.neuralNTree.neuralNTree.min,this.neuralNTree.neuralNTree.max]),O="<div class='nnt-point-container'>",u=0,c=y.length;u<c;u++)f+=u!==c-1?y[u].toFixed(4)+", ":y[u].toFixed(4),O+="<div class='input-group'><span class='input-group-addon'>"+v[u]+"</span><input type='text' id='node-index_"+u+"_"+t[s][i].index+"' class='node-index' onchange='pointChange(this)'></div>"
O+="</div>",f+="' placeholder='point' id='node-index_"+t[s][i].index+"' class='node-index' onchange='pointChange(this)'>"
var g=NNTFunctions.util.similarity(y,l)
g=parseInt(NNTFunctions.util.convertRange([g],[d,p],[0,255]))
var j=t[s][i].isTerminal?"Terminal "+t[s][i].index:"Node "+t[s][i].index
g<0?g=0:g>255&&(g=255)
var N=255-g,S=g,T=255-g,I="rgba("+N+","+S+","+T+",1)"
t[s][i].mergeIndex&&(this.mergeIndices[t[s][i].mergeIndex]=!0),this.nodes.add({id:t[s][i].index,label:t[s][i].index,level:s,info:f,points:O,size:25,shape:"square",featureCount:0,color:I,nodeHeader:j,cid:t[s][i].mergeIndex,currentPoints:O}),this.lastNodes.push({id:t[s][i].index,label:t[s][i].index,level:s,info:f,points:O,size:25,shape:"square",featureCount:0,color:I,nodeHeader:j,cid:t[s][i].mergeIndex,currentPoints:O}),null!==t[s][i].parent&&this.edges.add({from:t[s][i].index,to:t[s][i].parent.index})}var w=document.getElementById("neural-n-tree-visual"),D={nodes:this.nodes,edges:this.edges},x={edges:{smooth:{type:"cubicBezier",forceDirection:"vertical",roundness:.4}},layout:{hierarchical:{direction:"UD"}},physics:!1}
this.visual=new vis.Network(w,D,x),this.visual.on("click",function(t){var a=t.nodes,s=e.nodes.get(a)
if(s&&s[0]&&s&&s[0]&&s[0].points){var r=s[0].points,i=s[0].nodeHeader,n=($("<div class='change-nnt-point'></div>").html(r).dialog({width:750,height:600,closeOnEscape:!1,title:i,close:function(){$(this).dialog("destroy").remove()}}),e.neuralNTree.neuralNTree.nodesByIndex([a[0]]).point)
n=NNTFunctions.util.convertRange(n,[-2,2],[e.neuralNTree.neuralNTree.min,e.neuralNTree.neuralNTree.max])
for(var l=0,o=n.length;l<o;l++)n[l]=parseFloat(n[l])
var u=$(".change-nnt-point .node-index"),c=[]
for(var d in u)u.hasOwnProperty(d)&&"INPUT"===u[d].nodeName&&c.push(u[d])
for(var l=c.length-1;l>=0;l--)c[l].id.split("_")[2]!=a[0]&&c.splice(l,1)
for(var l=0;l<c.length;l++)c[l].value=n[l]}})},initClassification.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper),t=this
showLoader()
var a=isChrome()?analysisObjects.urls.templateUrl+"classification.html":"templates/classification.html"
e.load(a,function(){t.tree=t.classification.decisionTree,t.nodes=new vis.DataSet,t.edges=new vis.DataSet,t.levelCount=0,t.visual&&(t.visual.destroy(),t.visual=null)
for(var e=getLevelOrder(t.tree.root),a=0,s=e.length;a<s;a++){t.levelCount++
for(var r=0,i=e[a].length;r<i;r++)if(null!==e[a][r]&&void 0!==e[a][r]){for(var n=1,l=e[a][r].parent;e[a].indexOf(l)>-1;)n++,l=l.parent
t.nodes.add({label:e[a][r].category?1==e[a][r].category?"good":0==e[a][r].category?"medium":"bad":e[a][r].attribute+" "+e[a][r].predicateName+" "+e[a][r].pivot,level:t.levelCount+n,id:e[a][r].index,size:25,shape:"square",featureCount:0,color:1==e[a][r].category?"green":0==e[a][r].category?"blue":e[a][r].category?"red":e[a][r].noMatch?"orange":"yellow",info:e[a][r].pivot,predicate:e[a][r].predicateName,nodeId:e[a][r].index,attribute:e[a][r].attribute,category:e[a][r].category})
var o=e[a][r].noMatch?"no":"yes"
null!==e[a][r].parent&&void 0!==e[a][r].parent&&t.edges.add({from:e[a][r].index,to:e[a][r].parent.index,label:o})}}var u=document.getElementById("display-tree"),c={nodes:t.nodes,edges:t.edges},d={edges:{smooth:{type:"cubicBezier",forceDirection:"vertical",roundness:.4}},layout:{hierarchical:{direction:"UD"}},physics:!1}
if(t.visual=new vis.Network(u,c,d),automatic){for(var p=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,c=[],a=0;a<p.length;a++){var h={}
for(var m in p[a])"users"!==m&&(m in analysisObjects.miners.ignoredAttributes||"wellPerformed"===m)||(h[m]=p[a][m])
c.push(h)}for(var g=[],a=0;a<c.length;a++){var v=analysisObjects.miners.decisionTree.decisionTree.predict(c[a])
$("#users").html("")
var b={}
b.users=c[a].users,b.status=v,g.push(b)}generateUserList(g)}t.visual.on("click",function(e){var a=e.nodes,s=t.nodes.get(a)
if(s&&s[0])if(s&&s[0]&&s[0].info){var r="Pivot <input class='pivot' value='"+s[0].info+"' id='pivot_"+s[0].nodeId+"'><br>"
"=="===s[0].predicate?r+="Predicate <select id='predicate_"+s[0].nodeId+"' class='predicate'><option value='==' selected='selected'>equal</option><option value='!='>not equal</option><option value='>='>greater than or equal</option><option value='<='>less than or equal</option></select>":">="===s[0].predicate?r+="Predicate <select id='predicate_"+s[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!='>not equal</option><option value='>=' selected='selected'>greater than or equal</option><option value='<='>less than or equal</option></select>":"<="===s[0].predicate?r+="Predicate <select id='predicate_"+s[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!='>not equal</option><option value='>='>greater than or equal</option><option value='<=' selected='selected'>less than or equal</option></select>":r+="Predicate <select id='predicate_"+s[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!=' selected='selected'>not equal</option><option value='>='>greater than or equal</option><option value='<='>less than or equal</option></select>",r+="<br>",r+="Attribute <select id='attribute_"+s[0].nodeId+"' class='attribute'>"
for(var i in analysisObjects.miners.dataSet[0])i in analysisObjects.miners.ignoredAttributes||(r+=s[0].attribute==i?"<option value='"+i+"' selected='selected'>"+i+"</option>":"<option value='"+i+"'>"+i+"</option>")
r+="</select>"
$("<div></div>").html(r).dialog({width:300,height:400,closeOnEscape:!1,close:function(){$(this).dialog("destroy").remove()}})
$(".pivot").on("change",function(e){for(var a=e.target.id,s=a.split("_")[1],r=getLevelOrder(t.tree.root),i=0;i<r.length;i++)for(var n=0;n<r[i].length;n++)r[i][n]&&r[i][n].index==s&&(r[i][n].pivot=$("#"+a).val())
t.createUI()}),$(".predicate").on("change",function(e){for(var a=e.target.id,s=a.split("_")[1],r=getLevelOrder(t.tree.root),i=0;i<r.length;i++)for(var n=0;n<r[i].length;n++)r[i][n]&&r[i][n].index==s&&(r[i][n].predicateName=$("#"+a).val())
t.createUI()}),$(".attribute").on("change",function(e){for(var a=e.target.id,s=a.split("_")[1],r=getLevelOrder(t.tree.root),i=0;i<r.length;i++)for(var n=0;n<r[i].length;n++)r[i][n]&&r[i][n].index==s&&(r[i][n].attribute=$("#"+a).val())
t.createUI()})}else{var r=1==s[0].category?"<select id='category_"+s[0].nodeId+"' class='category'><option value='1' selected='selected'>Good</option><option value='0' selected='selected'>Medium</option><option value='-1'>Bad<option></select>":"<select id='category_"+s[0].nodeId+"' class='category'><option value='1'>Good</option><option value='0'>Medium</option><option value='-1' selected='selected'>Bad<option></select>"
$("<div></div>").html(r).dialog({width:300,height:400,closeOnEscape:!1,close:function(){$(this).dialog("destroy").remove()}})
$(".category").on("change",function(e){for(var a=e.target.id,s=a.split("_")[1],r=getLevelOrder(t.tree.root),i=0;i<r.length;i++)for(var n=0;n<r[i].length;n++)r[i][n]&&r[i][n].index==s&&(r[i][n].category=parseInt($("#"+a).val()))
t.createUI()})}}),t.generateClassificationTable(),hideLoader()})},initClassification.prototype.generateClassificationTable=function(){for(var e=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,t=[],a=0;a<e.length;a++){var s={}
for(var r in e[a])"users"!==r&&(r in analysisObjects.miners.ignoredAttributes||"wellPerformed"===r)||(s[r]=e[a][r])
t.push(s)}var i="<table id='c-table' class='table'><thead><tr>"
for(var r in t[0])i+="<th>"+r+"</th>"
i+="</tr><tbody>"
for(var a=0;a<t.length;a++){var n=this.tree.predict(t[a]),s=t[a]
i+=1==n?"<tr class='success'>":0==n?"<tr>":"<tr class='danger'>"
for(var r in s)r in analysisObjects.miners.ignoredAttributes&&"users"!==r||(i+="<td>"+s[r]+"</td>")
i+="</tr>"}i+="</tbody></table>",$("#classification-table").html(i),$("#c-table").tablesorter()},initAnomaly.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper),t=this
showLoader()
var a=isChrome()?analysisObjects.urls.templateUrl+"anomaly.html":"templates/anomaly.html"
e.load(a,function(){if(!analysisObjects.miners.anomaly)if(analysisObjects.miners.dataSet)try{t.anomaly=new Anomaly}catch(e){return void hideLoader()}else alert("No data set loaded")
if($("#apply-anomaly").on("click",function(e){showLoader()
var a=$("#anomaly-threshold").val()
analysisObjects.miners.anomaly.th=a
try{a=parseFloat(a)}catch(e){return void alert("Not a proper th-value")}for(var s=[],r="",i=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,n=0;n<i.length;n++){for(var l=getInputVector(i[n]),o=0;o<l.length;o++)l[o]=parseFloat(l[o])
for(var o=l.length-1;o>=0;o--)o in t.anomaly.similar&&l.splice(o,1)
l=$V(l)
var u=t.anomaly.outlier.checkIfOutlier(l,a)
s.push({input:getInputVectorTextAllAttributes(i[n]),status:u})}for(var c=t.anomaly.outlier.probs,d=0,n=0;n<c.length;n++)d+=c[n]
c.length>0&&(d/=c.length)
$("#anomaly-threshold").val(),isNaN(d)||$("#anomaly-threshold").val(d),r="<table id='a-table' class='table'><thead><tr>"
for(var p=getKeysAllAttributes(i[0]),n=0;n<p.length;n++)r+="<th>"+p[n]+"</th>"
r+="</tr></thead><tbody>"
for(var n=0;n<s.length;n++){r+=s[n].status?"<tr class='danger'>":"<tr class='success'>"
for(var o=0;o<s[n].input.length;o++)1e-6==s[n].input[o]&&(s[n].input[o]=0),r+="<td>"+s[n].input[o]+"</td>"
r+="</tr>"}r+="</tbody></table>",$("#anomaly-table").html(r),$("#a-table").tablesorter(),hideLoader()}),hideLoader(),analysisObjects.miners.anomaly){t.anomaly=analysisObjects.miners.anomaly
var e=analysisObjects.miners.anomaly.th||$("#anomaly-threshold").val()
$("#anomaly-threshold").val(e),$("#apply-anomaly").click()}})},initCharts.prototype.createUI=function(){var e=($(analysisObjects.uiConstants.wrapper),this)
showLoader(),$("#charts-radar").remove(),$("#charts-line").remove(),$("#settings-div").append("<canvas id='charts-line'><canvas>"),$("#settings-div").append("<canvas id='charts-radar'></canvas>")
var t=document.getElementById("charts-radar").getContext("2d"),a=document.getElementById("charts-line").getContext("2d")
e.dataSet=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,e.curDataSet=[]
for(var s in e.dataSet[0]){var r=[]
if(!(isNaN(e.dataSet[0][s])||s in analysisObjects.miners.ignoredAttributes)){for(var i=0;i<e.dataSet.length;i++)r.push(e.dataSet[i][s])
e.curDataSet.push({label:s,data:r,backgroundColor:function(){return"rgba("+Math.floor(250*Math.random())+","+Math.floor(250*Math.random())+","+Math.floor(250*Math.random())+",0.3)"}()})}}e.labels=[]
for(var i=0;i<e.dataSet.length;i++)e.labels.push(i+"")
var n={type:"radar",data:{labels:e.labels,datasets:e.curDataSet},options:{}},l={type:"line",data:{labels:e.labels,datasets:e.curDataSet},options:{}}
e.chartOptions=n
var o=new Chart(t,n),u=new Chart(a,l)
e.radarChart=o,e.lineChart=u,hideLoader()},initApriori.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper),t=this,a=isChrome()?analysisObjects.urls.templateUrl+"apriori.html":"templates/apriori.html"
e.load(a,function(){$("#apriori-apply").on("click",function(e){var a=$("#apriori-min-confidence").val(),s=$("#apriori-min-support").val(),r=$("#apriori-iterations").val()
try{a=parseFloat(a),s=parseFloat(s),r=parseInt(r)}catch(e){return void alert("Not a proper apriori-value")}t.apriori=new Association(a,s,!1,r).apriori,t.buildUI()}),analysisObjects.miners.apriori&&(t.apriori=analysisObjects.miners.apriori.apriori,t.buildUI()),$("#apriori-apply").click()})},initApriori.prototype.buildUI=function(){for(var e=this.apriori.frequentItemSets,t=this.apriori.associationRules,a="<table id='asso-table' class='table'><thead><tr><th>LHS</th><th>RHS</th><th>Confidence</th></tr></thead><tbody>",s=[],r=[],i={},n=0;n<t.length;n++){var l=t[n],o={}
o.id=l.lhs.join(),o.label=l.lhs.join()
var u={}
u.id=l.rhs.join(),u.label=l.rhs.join()
var c={}
c.from=o.id,c.to=u.id,c.arrows="from",i[o.id]||s.push(o),i[u.id]||s.push(u),r.push(c),i[o.id]=!0,i[u.id]=!0}i=null
for(var d=0;d<t.length;d++){var l=t[d]
a+="<tr><td>"+l.lhs.join()+"</td><td>"+l.rhs.join()+"</td><td>"+l.confidence+"</td></tr>"}var p="<table id='freq-table' class='table'><thead><tr><th>Item</th><th>Support</th></tr></thead><tbody>"
for(var d in e)for(var h=e[d],m=0;m<h.length;m++){var g=h[m],v=g.itemSet.join(),b=g.support
p+="<tr><td>"+v+"</td><td>"+b+"</td></tr>"}p+="</tbody></table>"
var f={},y={nodes:s,edges:r},O=document.getElementById("apriori-table")
O.style.width="900px",O.style.height="900px",new vis.Network(O,y,f),$("#apriori-support-div").html(p),$("#freq-table").tablesorter(),$("#asso-table").tablesorter()}
