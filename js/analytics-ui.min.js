"use strict";var analysisObjects=analysisObjects||{};analysisObjects.miners={neuralNTree:null,neuralNTreeSettings:null,decisionTree:null,decisionTreeSettings:null,anomaly:null,anomalySettings:null,charts:null,chartsSettings:null,settings:null,dataSet:null,curDataSet:null,groupDataSet:null,neuralNTreeHeaders:null,neuralNTreeNotes:null,apriori:null,ignoredAttributes:{id:!0,wellPerformed:!0,hiddenId:!0,vector_id:!0,session_id:!0,users:!0,timestamp:!0,anomaly:!0},classificationWellPerformed:{},minTime:null,maxTime:null,reducedTimeDataSet:null,resetDatasets:function(){analysisObjects.miners.dataSet=[],analysisObjects.miners.curDataSet=null,analysisObjects.miners.groupDataSet=null,analysisObjects.miners.reducedTimeDataSet=null,analysisObjects.miners.classificationWellPerformed={}}},analysisObjects.uiConstants={wrapper:"#analysis-content",settings:"#analysis-settings",removeContent:function(){tinymce.activeEditor&&tinymce.activeEditor.remove(),$(this.wrapper).html(""),$(this.settings).hide()}},analysisObjects.urls={templateUrl:window.location.href.replace("index.html","")+"templates/",baseUrl:"https:"===location.protocol?"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/":"http://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/"},analysisObjects.dataFetchUrls={snap:analysisObjects.urls.baseUrl+"get_programming_vectors_pilot_2.php",uui:analysisObjects.urls.baseUrl+"get_uui_vectors_pilot_2.php",print:analysisObjects.urls.baseUrl+"get_search_vectors_pilot_2.php",brainstorm:analysisObjects.urls.baseUrl+"get_brainstorm_vectors_pilot_2.php",todo:analysisObjects.urls.baseUrl+"get_todo_vectors_pilot_2.php"},analysisObjects.notifyUrls={snap:analysisObjects.urls.baseUrl+"notify_programming.php",uui:analysisObjects.urls.baseUrl+"notify_uui.php",print:analysisObjects.urls.baseUrl+"notify_print.php",brainstorm:analysisObjects.urls.baseUrl+"notify_brainstorm.php"};var Settings=function(){};Settings.prototype.reset=function(){analysisObjects.miners.settings=null,this.settings=null},Settings.prototype.save=function(){analysisObjects.miners.settings=this};var Association=function(e,t,a,s){for(var i=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,n=[],r=0;r<i.length;r++)n.push(getInputVectorTextKey(i[r]));this.trainingSet=n,this.apriori=new Apriori.Algorithm(e,t,a,s).showAnalysisResultFromFile(this.trainingSet),this.save()};Association.prototype.save=function(){analysisObjects.miners.apriori=this},Association.prototype.reset=function(){analysisObjects.miners.apriori=null,this.apriori=null};var NeuralNTree=function(e,t,a,s,i,n){if(analysisObjects.miners.neuralNTree)this.neuralNTree=analysisObjects.miners.neuralNTree.neuralNTree;else{var r={};r.size=2*e-1,r.dimensions=i,r.learningRate=s,r.scaleMin=t,r.scaleMax=a,this.neuralNTree=new NNTFunctions.NeuralNTree(r),this.save()}};NeuralNTree.prototype.save=function(){analysisObjects.miners.neuralNTree=this},NeuralNTree.prototype.reset=function(){analysisObjects.miners.neuralNTree=null,analysisObjects.miners.neuralNTreeSettings=null,this.neuralNTree=null};var DecisionTree=function(){this.data=JSON.parse(JSON.stringify(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet));for(var e=[],t=this.data.length-1;0<=t;t--)void 0===this.data[t].wellPerformed||-2==this.data[t].wellPerformed?this.data.splice(t,1):this.data[t].wellPerformed=parseInt(this.data[t].wellPerformed);for(t=0;t<this.data.length;t++){var a={};for(var s in this.data[t])s in analysisObjects.miners.ignoredAttributes&&"wellPerformed"!==s||(isNaN(this.data[t][s])?a[s]=this.data[t][s]:a[s]=parseFloat(this.data[t][s]));e.push(a)}this.data=e,this.config={trainingSet:this.data,categoryAttr:"wellPerformed"},this.decisionTree=new dt.DecisionTree(this.config),this.save()};DecisionTree.prototype.save=function(){analysisObjects.miners.decisionTree=this},DecisionTree.prototype.reset=function(){analysisObjects.miners.decisionTree=null,this.decisionTree=null};var Anomaly=function(){this.data=JSON.parse(JSON.stringify(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet));for(var e=[],t=this.data.length-1;0<=t;t--)-1==this.data[t].anomaly?this.data[t].anomaly=-1:0==this.data[t].anomaly?this.data[t].anomaly=0:this.data[t].anomaly=1;for(t=0;t<this.data.length;t++){var a={};for(var s in this.data[t])s in analysisObjects.miners.ignoredAttributes&&"anomaly"!==s||(isNaN(this.data[t][s])?a[s]=this.data[t][s]:a[s]=parseFloat(this.data[t][s]));e.push(a)}for(t=e.length-1;0<=t;t--)0==e[t].anomaly&&e.splice(t,1);this.data=e,this.config={trainingSet:this.data,categoryAttr:"anomaly"},this.anomaly=new dt.DecisionTree(this.config),this.save()};Anomaly.prototype.save=function(){analysisObjects.miners.anomaly=this},Anomaly.prototype.reset=function(){this.outlier=null,analysisObjects.miners.anomaly=null};var Charts=function(){};function initSettings(){analysisObjects.uiConstants.removeContent(),this.settings=analysisObjects.miners.settings||new Settings,this.createUI(),logSettings()}function initCluster(){analysisObjects.uiConstants.removeContent(),initNeuralNTreeSettings(),this.settings=analysisObjects.miners.neuralNTreeSettings||null,this.neuralNTree=analysisObjects.miners.neuralNTree||null,this.createUI()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function initClassification(){analysisObjects.uiConstants.removeContent(),this.classification=analysisObjects.miners.decisionTree||new DecisionTree,this.createUI()}function initAnomaly(){analysisObjects.uiConstants.removeContent(),this.createUI()}function initCharts(){this.createUI()}function initApriori(){analysisObjects.uiConstants.removeContent(),this.createUI()}function parseTrainSet(e){var t=e.target.files[0];if(t){showLoader();var a=new FileReader;a.onload=function(e){var t=e.target.result;try{t=t.replace("\n",""),JSON.parseAsync(t,function(e){var t=e;fetchDataSet(t),initOptions(t),$(".analysis-tools").show(),$("#settings-div").fadeIn(),hideLoader()})}catch(e){return void alert("Not in a proper JSON-format.")}},a.readAsText(t)}else alert("Error while loading the input file.")}function initOptions(e){showLoader(),generateAttributeCheckboxes(e[0]),generateGroupBySelect(e),initTimePicker("#start-time","#end-time"),generateUserList(e),hideLoader()}function initNeuralNTreeSettings(){var e=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,t=getMinMax(e),a=getInputVector(e[0]).length;analysisObjects.miners.neuralNTreeSettings||(analysisObjects.miners.neuralNTreeSettings={}),analysisObjects.miners.neuralNTreeSettings.min=t.min,analysisObjects.miners.neuralNTreeSettings.max=t.max,analysisObjects.miners.neuralNTreeSettings.dimensions=a}function getHeaders(e){var t=analysisObjects.miners.ignoredAttributes,a=[];for(var s in e)s in t||isNaN(e[s])||a.push(s);return a}function getHeadersText(e){var t=analysisObjects.miners.ignoredAttributes,a=[];for(var s in e)s in t||a.push(s);return a}function getMinMax(e){for(var t,a,s=analysisObjects.miners.ignoredAttributes,i={},n=0;n<e.length;n++){var r=e[n];for(var o in r)o in s||isNaN(r[o])||(t||(t=r[o]),a||(a=r[o]),t>r[o]&&(t=r[o]),a<r[o]&&(a=r[o]))}return i.min=t,i.max=a,i}function getDimensions(e){var t=analysisObjects.miners.ignoredAttributes,a=0;for(var s in e)s in t||isNaN(e[s])||a++;return a}function getInputVector(e){var t=analysisObjects.miners.ignoredAttributes,a=[];for(var s in e)s in t||isNaN(e[s])||a.push(parseFloat(e[s]));return a}function getInputVectorText(e){var t=analysisObjects.miners.ignoredAttributes,a=[];for(var s in e)s in t||a.push(e[s]);return a}function getInputVectorTextAllAttributes(e){var t=[];for(var a in e)"timestamp"!==a&&"hiddenId"!==a&&"wellPerformed"!==a&&"anomaly"!==a?t.push(e[a]):"timestamp"===a&&t.push(new Date(+e[a]).toString());return t}function getKeysAllAttributes(e){var t=[];for(var a in e)"hiddenId"!==a&&"wellPerformed"!==a&&"anomaly"!==a&&t.push(a);return t}function getInputVectorTextKey(e){var t=analysisObjects.miners.ignoredAttributes,a=[];for(var s in e)s in t||a.push(s+": "+e[s]);return a}function generateUserList(e){$("#users").html("");for(var t={},a=0;a<e.length;a++){var s=e[a];s.users&&(t[s.users]=s.status?s.status:0)}var i="<ul id='user-list'>",n=0;for(var r in t){i+="<li onclick='sendMessage(this);' class='ui-state-default "+(1==t[r]?"user-good":0==t[r]?"user-medium":"user-bad")+"' id='user-list_"+r+"'>"+r+"</li>",n++}i+="</ul>",$("#users").html(i),$("#user-list").sortable(),setMessage(n+" users found")}function sendMessage(e){var s=e.id.split("_")[1];bootbox.prompt({title:"Send a message to "+s,inputType:"textarea",callback:function(e){var t=e,a=window.sessionStorage.getItem("sessionId");t&&$.ajax({type:"POST",url:"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_student_message.php",data:"user="+s+"&message="+t+"&sessionId="+a,success:function(e){setMessage("Message has been sent to "+s)},error:function(e){alert("Error while sending a message.")}})}})}function initTimePicker(){$("#datetimepicker6").datetimepicker(),$("#datetimepicker7").datetimepicker({useCurrent:!1}),$("#datetimepicker6").on("dp.change",function(e){$("#datetimepicker7").data("DateTimePicker").minDate(e.date);var t=reduceDataSetBasedOnTime(e.date._d,"start-time");t&&(analysisObjects.miners.reducedTimeDataSet=t,analysisObjects.miners.curDataSet=null,generateAttributeTable(analysisObjects.miners.reducedTimeDataSet))}),$("#datetimepicker7").on("dp.change",function(e){$("#datetimepicker6").data("DateTimePicker").maxDate(e.date);var t=reduceDataSetBasedOnTime(e.date._d,"end-time");t&&(analysisObjects.miners.reducedTimeDataSet=t,analysisObjects.miners.curDataSet=null,generateAttributeTable(analysisObjects.miners.reducedTimeDataSet))})}function generateAttributeCheckboxes(e){$("#attributes").html("");var t="<h3>Features included</h3><div>";for(var a in e)"hiddenId"!==a&&(t+="id"!==a&&"vector_id"!==a&&"session_id"!==a&&"users"!==a&&"timestamp"!==a?"<br><input type='checkbox' class='us-attribute-box' id='us-attribute-box_"+a+"' checked>"+a:"<br><input type='checkbox' class='us-attribute-box' id='us-attribute-box_"+a+"'>"+a);t+="</div></div>",$("#attributes").html(t),$(".us-attribute-box").on("change",function(e){var t=$("#"+e.target.id).is(":checked"),a=e.target.id.split("_");a.shift(),a=a.join("_"),t?delete analysisObjects.miners.ignoredAttributes[a]:analysisObjects.miners.ignoredAttributes[a]=!0,initNeuralNTreeSettings()})}function resetMiners(){for(var e in analysisObjects.miners)analysisObjects.miners[e]&&void 0!==analysisObjects.miners[e].reset&&analysisObjects.miners[e].reset();analysisObjects.miners.classificationWellPerformed={},setMessage("Miners have been reseted")}function generateAttributeTable(e){for(var t=0;t<e.length;t++)e[t].hiddenId=t,e[t].anomaly=0,e[t].wellPerformed=-2;$("#data-set-table").html("");var a="<table id='attribute-table' class='table'><thead><tr>";for(var s in e[0])"anomaly"!==s&&"hiddenId"!==s&&"wellPerformed"!==s&&(a+="<th>"+s+"</th>");a+="<th>Predict</th>",a+="<th>Anomaly</th>",a+="</tr></thead><tbody>";for(t=0;t<e.length;t++){for(var s in a+="<tr class='well-performed' id='"+e[t].hiddenId+"'>",e[t])if("users"!==s&&"anomaly"!==s&&"hiddenId"!==s&&"wellPerformed"!==s&&"timestamp"!==s&&"notes"!==s)i=e[t][s],isNaN(i)||null===i?a+="<td>"+i+"</td>":a+="<td>"+(i=+(i=parseFloat(i)).toFixed(2))+"</td>";else if("notes"===s){var i=e[t].notes;i||(i=0),a+="<td><input style='width: 30px;' type='text' value='"+i+"' id='notes-"+e[t].hiddenId+"' class='notes'></td>"}else if("timestamp"===s){a+="<td>"+new Date(parseInt(e[t][s])).toString()+"</td>"}else"users"===s&&(a+="<td><button class='btn btn-link' onclick='generateTimeLine(this)' id='timeline-"+e[t].hiddenId+"'>"+e[t][s]+"</button></td>");a+="<td><select id='option-"+e[t].hiddenId+"' onchange='selectPerformance(this);'><option value='-2' selected='selected'>Not included</option><option value='-1'>Not performing well</option><option value='0'>Neutral</option><option value='1'>Performing well</option></select></td>",a+="<td><select id='anomaly-"+e[t].hiddenId+"' onchange='selectAnomaly(this);'><option value='0' selected='selected'>Not included</option><option value='1'>Not an anomaly</option><option value='-1'>Anomaly</option>",a+="</tr>"}a+="</tbody></table>",$("#data-set-table").html(a),$("#attribute-table").tablesorter(),$(".notes").on("change",function(e){for(var t=e.target.value,a=e.target.id.split("-")[1],s=0;s<analysisObjects.miners.dataSet.length;s++)if(analysisObjects.miners.dataSet[s].hiddenId===parseInt(a)){analysisObjects.miners.dataSet[s].notes=parseFloat(t);break}})}function selectPerformance(e){for(var t=e.id.split("-")[1],a=e.value,s=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,i=0;i<s.length;i++)if(s[i].hiddenId==t){s[i].wellPerformed=a;break}}function selectAnomaly(e){for(var t=e.id.split("-")[1],a=e.value,s=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,i=0;i<s.length;i++)if(s[i].hiddenId==t){s[i].anomaly=a;break}}function groupBy(e,t){for(var a=analysisObjects.miners.ignoredAttributes,s=[],i={},n=0;n<e.length;n++){var r=e[n],o=r[t];if(i[o])for(var l in r)l!==t&&i[o][l]&&i[o][l].push(r[l]);else for(var l in i[o]={},r)l!==t?(i[o][l]=[],i[o][l].push(r[l])):(i[o][l]=[],i[o][l].push(o))}for(var l in i)s.push(i[l]);for(n=0;n<s.length;n++){var d=s[n];for(var l in d){for(var c=0,u=0;u<d[l].length;u++)isNaN(d[l][u])||(c+=parseFloat(d[l][u]));c=0<d[l].length?c/d[l].length:0,s[n][l]="id"===l||l in a||"users"===l?d[l][0]:c}}return s}function groupBySum(e,t){for(var a=analysisObjects.miners.ignoredAttributes,s=[],i={},n=0;n<e.length;n++){var r=e[n],o=r[t];if(i[o])for(var l in r)l!==t&&i[o][l]&&i[o][l].push(r[l]);else for(var l in i[o]={},r)l!==t?(i[o][l]=[],i[o][l].push(r[l])):(i[o][l]=[],i[o][l].push(o))}for(var l in i)s.push(i[l]);for(n=0;n<s.length;n++){var d=s[n];for(var l in d){for(var c=0,u=0;u<d[l].length;u++)isNaN(d[l][u])||(c+=parseFloat(d[l][u]));s[n][l]="id"===l||l in a||"users"===l?d[l][0]:c}}return s}function normalize(e,t){for(var a=analysisObjects.miners.ignoredAttributes,s=[],i=0;i<e.length;i++){var n={},r=(e[i][t],e[i][t]);for(var o in e[i])o===t||"id"===o||o in a?"id"===o?n.id=e[i].id:o in a&&(n[o]=e[i][o]):n[o]=e[i][o]/r;s.push(n)}return s}function generateGroupBySelect(e){window.sessionStorage.setItem("groupBy","average");var t="<h3>Display grouping by</h3><br><div class='radio'><label><input type='radio' name='group-by-results' value='average' checked>By average</label><br><label><input type='radio' name='group-by-results' value='sum'>By sum</label></div><br><h3>Group by</h3><div class='radio'>";for(var a in t+="<br><label><input type='radio' name='group-by-radio' id='radio_no-group' value='no-group' checked> No groupping </label>",e[0])"users"===a&&"hiddenId"!==a&&(t+="<br><label><input type='radio' name='group-by-radio' id='radio_"+a+"'value='"+a+"'>"+a+"</label>");t+="</div>",$("#group-by").html(t),$("input[type=radio][name=group-by-results]").on("change",function(){var e=$(this).val();if(window.sessionStorage.setItem("groupBy",e),"no-group"!==(e=$("input[type=radio][name=group-by-radio]:checked").val())){var t=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;"average"===window.sessionStorage.getItem("groupBy")?analysisObjects.miners.groupDataSet=groupBy(t,e):analysisObjects.miners.groupDataSet=groupBySum(t,e),generateAttributeTable(analysisObjects.miners.groupDataSet),$("#normalize").show()}else{analysisObjects.miners.curDataSet=null,analysisObjects.miners.groupDataSet=null;t=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;analysisObjects.miners.groupDataSet=null,$("#normalize").hide(),generateAttributeTable(t)}}),$("input[type=radio][name=group-by-radio]").on("change",function(){var e=$(this).val();if("no-group"!==e){var t=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;"average"===window.sessionStorage.getItem("groupBy")?analysisObjects.miners.groupDataSet=groupBy(t,e):analysisObjects.miners.groupDataSet=groupBySum(t,e),generateAttributeTable(analysisObjects.miners.groupDataSet),window.sessionStorage.setItem("groupped",!0),$("#show-one").attr("disabled",!1),$("#normalize").show()}else{$("#show-one").attr("disabled",!0),analysisObjects.miners.curDataSet=null,analysisObjects.miners.groupDataSet=null;t=analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;analysisObjects.miners.groupDataSet=null,$("#normalize").hide(),generateAttributeTable(t),window.sessionStorage.setItem("groupped",!1)}})}function generateNormalize(e){var t="<h3>Percentage of the features by</h3><div class='radio'>";for(var a in t+="<br><label><input type='radio' name='normalize-radio' id='normalize_no-normalize' value='no-normalize' checked> No normalizing </label>",e[0])"hiddenId"!==a&&(t+="<br><label><input type='radio' name='normalize-radio' id='normalize_"+a+"'value='"+a+"'>"+a+"</label>");t+="</div>",$("#normalize").html(t),$("#normalize").hide(),$("input[type=radio][name=normalize-radio]").on("change",function(){if(analysisObjects.miners.groupDataSet){var e=$(this).val();analysisObjects.miners.curDataSet="no-normalize"!==e?normalize(analysisObjects.miners.groupDataSet,e):analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,generateAttributeTable(analysisObjects.miners.curDataSet),initNeuralNTreeSettings()}else alert("Grouping has to be made before normalizing")})}function convertMillisToDate(e){var t=new Date(e),a=t.getHours(),s=12<=a?"PM":"AM";a="00"==(a=12<a?a-12:a)?12:a;var i=t.getMinutes();return a+":"+(i=i<=9?"0"+i:i)+" "+s}function reduceDataSetBasedOnTime(e,t){var a=e;if(!e)return analysisObjects.miners.reducedTimeDataSet=null,generateAttributeTable(analysisObjects.miners.dataSet),void("start-time"===t?analysisObjects.miners.minTime=null:"end-time"===t&&(analysisObjects.miners.maxTime=null));switch(t){case"start-time":analysisObjects.miners.minTime=a;break;case"end-time":analysisObjects.miners.maxTime=a}if(analysisObjects.miners.minTime||analysisObjects.miners.maxTime){var s,i;if(analysisObjects.miners.minTime&&(s=analysisObjects.miners.minTime),analysisObjects.miners.maxTime&&(i=analysisObjects.miners.maxTime),i<s)return void alert("Start time filter larger than end time filter");for(var n=[],r=analysisObjects.miners.curDataSet||analysisObjects.miners.dataSet,o=0;o<r.length;o++){var l=r[o],d=l.timestamp;d||(d=l.time);var c=new Date(parseInt(d));s&&i&&s<=c&&c<=i?n.push(l):s&&!i&&s<=c?n.push(l):!s&&i&&c<=i&&n.push(l)}return n}return null}function pointChange(e){var t=e.id,a=$("#"+t).val(),s=t.split("_")[2],i=t.split("_")[1],n=parseFloat(a);analysisObjects.miners.neuralNTree.neuralNTree.nodes[s].point[i]=n,$("#"+t).val(a)}function fetchDataSet(e){analysisObjects.miners.dataSet&&0!==analysisObjects.miners.dataSet.length||(analysisObjects.miners.dataSet=[]);for(var t=0;t<e.length;t++)analysisObjects.miners.dataSet.push(e[t]);for(var a=0;a<analysisObjects.miners.dataSet.length;a++)analysisObjects.miners.dataSet[a].notes=0;generateAttributeTable(analysisObjects.miners.dataSet),initNeuralNTreeSettings(),$("input[type=radio][name=group-by-results]").trigger("change"),setMessage(t+" data instances loaded")}function setMessage(){for(var e="",t=0;t<arguments.length;t++)e+="<div class='alert alert-success alert-dismissable text-center'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+arguments[t]+"</div>";$("#messages").append(e),$(".alert").slideUp(2e3)}function showLoader(){$("#loader").show()}function hideLoader(){$("#loader").hide()}function buildStudentModels(){var e,t=new DecisionTree;try{e=new Anomaly}catch(e){}for(var a=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,s=[],i=0;i<a.length;i++){s.push({users:a[i].users,sessionId:window.sessionStorage.getItem("sessionId"),status:1===parseInt(t.decisionTree.predict(a[i]))?1:0===parseInt(t.decisionTree.predict(a[i]))?0:-1});var n=1===parseInt(t.decisionTree.predict(a[i]))?"wellPerformed":0===parseInt(t.decisionTree.predict(a[i]))?"Medium":"NotWellPerformed",r="users="+a[i].users+"&sessionId="+window.sessionStorage.getItem("sessionId")+"&classification="+n;$.ajax({type:"POST",url:"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_classification_vectors_pilot_2.php",data:r,success:function(e){},error:function(e){}})}if(e)for(i=0;i<a.length;i++){p=1===(p=parseInt(e.anomaly.predict(a[i])))?-1:1;for(var o=0;o<s.length;o++)if(s[o].users===a[i].users){n=1===p?0:1;$.ajax({type:"POST",url:"https://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_anomaly_vectors_pilot_2.php",data:"users="+a[i].users+"&sessionId="+window.sessionStorage.getItem("sessionId")+"&anomalies="+n,success:function(e){},error:function(e){}}),s[o].status+=p}}s=function(e,t){for(var a={},s=0,i=e.length;s<i;s++)a[e[s][t]]||(a[e[s][t]]=e[s]);var n=[];for(var r in a)n.push(a[r]);return n}(s,"users");var l,d,c=-1/0;for(i=0;i<s.length;i++)s[i].status>c&&(c=s[i].status);for(i=0;i<s.length;i++){var u=s[i],p=(u.status-(l=[-2,2])[0])*((d=[0,100])[1]-d[0])/(l[1]-l[0])+d[0];r="users="+u.users+"&sessionId="+window.sessionStorage.getItem("sessionId")+"&status="+p;$.ajax({method:"POST",url:"http://cs.uef.fi/~tapanit/ecraft2learn/api/pilot_2/put_student_models_pilot_2.php",data:r,success:function(e){},error:function(e){}})}t.reset(),e&&e.reset()}function Reflect(){analysisObjects.uiConstants.removeContent(),this.createUI()}function generateTimeLine(e){for(var t=e.id.split("-")[1],a="",s=0;s<analysisObjects.miners.dataSet.length;s++)if(analysisObjects.miners.dataSet[s].hiddenId==t){a=analysisObjects.miners.dataSet[s].users;break}var i=[];for(s=0;s<analysisObjects.miners.dataSet.length;s++)analysisObjects.miners.dataSet[s].users==a&&i.push(analysisObjects.miners.dataSet[s]);var n=[];for(s=0;s<i.length;s++){var r=i[s],o=null;for(var l in r)"timestamp"!==l&&"wellPerformed"!==l&&"hiddenId"!==l&&"users"!==l&&r[l]&&(o=l);var d={};d.id=r.hiddenId,d.content=o;var c=parseInt(r.timestamp),u=new Date(c);d.start=u.toString(),n.push(d)}n.sort(function(e,t){return new Date(e.start)-new Date(t.start)}),$("<div id='timeline-dialog-"+t+"'></div>").dialog({width:650,height:600}),new vis.Timeline(document.getElementById("timeline-dialog-"+t),n,{})}initSettings.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.settings);e.show(),""===e.html()&&e.load("templates/settings.html",function(){})},initCluster.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper),S=this;showLoader();var t=isChrome()?analysisObjects.urls.templateUrl+"cluster.html":"templates/cluster.html";e.load(t,function(){S.settings&&(S.settings.size&&$("#max-clusters").val(S.settings.size),S.settings.alpha&&$("#alpha").val(S.settings.alpha),$("#dimensions").val(S.settings.dimensions),$("#min").val(S.settings.min),$("#max").val(S.settings.max)),S.neuralNTree&&S.visualiseNeuralNTree(),$("#forward").on("click",function(e){if(showLoader(),!S.neuralNTree){try{var t=parseInt($("#max-clusters").val()),a=parseFloat($("#alpha").val()),s=parseInt($("#dimensions").val()),i=parseFloat($("#min").val()),n=parseFloat($("#max").val());0==i&&(i=1e-7),0==n&&(n=1e-7)}catch(e){return void alert("Not a valid Neural N-Tree parameter")}S.neuralNTree=new NeuralNTree(t,i,n,a,s),S.settings={},S.settings.size=t,S.settings.alpha=a,S.settings.dimensions=s,S.settings.min=i,S.settings.max=n,analysisObjects.miners.neuralNTreeSettings=S.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){for(var r=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,o=0;o<r.length;o++)S.neuralNTree.neuralNTree.forwardTrain(getInputVector(r[o]));S.visualiseNeuralNTree()}else alert("No data set specified");hideLoader()}),$("#backward").on("click",function(e){if(showLoader(),!S.neuralNTree){try{var t=parseInt($("#max-clusters").val()),a=parseFloat($("#alpha").val()),s=parseInt($("#dimensions").val()),i=parseFloat($("#min").val()),n=parseFloat($("#max").val());0==i&&(i=1e-7),0==n&&(n=1e-7)}catch(e){return void alert("Not a valid Neural N-Tree parameter")}S.neuralNTree=new NeuralNTree(t,i,n,a,s),S.settings={},S.settings.size=t,S.settings.alpha=a,S.settings.dimensions=s,S.settings.min=i,S.settings.max=n,analysisObjects.miners.neuralNTreeSettings=S.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){for(var r=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,o=0;o<r.length;o++)S.neuralNTree.neuralNTree.backwardTrain(getInputVector(r[o]));S.visualiseNeuralNTree()}else alert("No data set specified");hideLoader()}),$("#cluster").on("click",function(e){if(showLoader(),!S.neuralNTree){try{var t=parseInt($("#max-clusters").val()),a=parseFloat($("#alpha").val()),s=parseInt($("#dimensions").val()),i=parseFloat($("#min").val()),n=parseFloat($("#max").val());0==i&&(i=1e-7),0==n&&(n=1e-7)}catch(e){return void alert("Not a valid Neural N-Tree parameter")}S.neuralNTree=new NeuralNTree(t,i,n,a,s),S.settings={},S.settings.size=t,S.settings.alpha=a,S.settings.dimensions=s,S.settings.min=i,S.settings.max=n,analysisObjects.miners.neuralNTreeSettings=S.settings}if(analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet){var r=[],o=Object.assign([],S.lastNodes);S.nodes.update(o);for(var l=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,d=0;d<l.length;d++){var c=S.neuralNTree.neuralNTree.cluster(getInputVector(l[d])).index;r[c]||(r[c]=[]),r[c].push(getInputVector(l[d]));for(var u=l[d],p=0,m=l[d].length;p<m;p++)p<m-1?l[d][p].toFixed(4)+", ":l[d][p].toFixed(4);t=S.nodes.get(c).size;var h=S.nodes.get(c).info,g=S.nodes.get(c).featureCount,b=S.nodes.get(c).label+"";if(g++,"INPUT"===$(h).prop("tagName")){h="["+(h=$(h).val())+"]",h=JSON.parse(h);var y="<table class='table' style='width: 100%;'><tr>",v=getHeaders(l[d]);for(p=0,m=h.length;p<m;p++)y+="<th>"+v[p]+"</th>";y+="<th>Users</th>",y+="</tr><tr>",u=getInputVector(u);for(p=0;p<u.length;p++)y+="<td>"+ +u[p].toFixed(4)+"</td>";analysisObjects.miners.neuralNTreeNotes&&analysisObjects.miners.neuralNTreeNotes[d]?y+="<td>"+analysisObjects.miners.neuralNTreeNotes[d]+"</td>":l[d].users?y+="<td>"+l[d].users+"</td>":l[d].id?y+="<td>"+l[d].id+"</td>":y+="<td>No notes</td>",y+="</tr>",y+="</table>"}else{var f=h.substring(0,h.length-8),O="<tr>";for(p=0,m=(u=getInputVector(u)).length;p<m;p++)O+="<td>"+ +u[p].toFixed(4)+"</td>";analysisObjects.miners.neuralNTreeNotes&&analysisObjects.miners.neuralNTreeNotes[d]?O+="<td>"+analysisObjects.miners.neuralNTreeNotes[d]+"</td>":l[d].users?O+="<td>"+l[d].users+"</td>":l[d].id?O+="<td>"+l[d].id+"</td>":O+="<td>No notes</td>";y=f+(O+="</tr></table>")}h+="<br>"+JSON.stringify(u),b=b.split("\n")[0]+"\nn = "+g,t+=.3,S.nodes.update({id:c,size:t,points:S.nodes.get(c).currentPoints+"<hr>"+y,info:y,featureCount:g,label:b})}var j=[];for(d=0;d<r.length;d++)for(p=0;p<r.length;p++)if(d!==p&&r[d]&&r[p]&&0<r[d].length&&0<r[p].length){o=S.silhouette(r[d],r[p]);j.push({"How similar the clusters are (-1 to 1)":o,Cluster:d,"Compared cluster":p})}j.sort(function(e,t){return e["How similar the clusters are (-1 to 1)"]<t["How similar the clusters are (-1 to 1)"]?-1:e["How similar the clusters are (-1 to 1)"]>t["How similar the clusters are (-1 to 1)"]?1:0}),S.createSilhouetteTable(j),logCluster()}else alert("No data set specified");hideLoader()}),$("#forward").click(),$("#cluster").click(),$("#reset-cluster").on("click",function(e){S.neuralNTree=null,analysisObjects.miners.neuralNTree&&analysisObjects.miners.neuralNTree.reset(),setMessage("Neural N-Tree has been reseted")}),hideLoader()})},initCluster.prototype.createSilhouetteTable=function(e){var t="<table class='table'><thead><tr>";for(var a in e[0])t+="<th>"+a+"</th>";t+="</tr><tbody>";for(var s=0;s<e.length;s++){for(var a in t+=0<e[s]["How similar the clusters are (-1 to 1)"]?"<tr class='success'>":"<tr class='danger'>",e[s])t+="<td>"+ +e[s][a].toFixed(2)+"</td>";t+="</tr>"}t+="</tbody></table>",$("#silhouettes").html(t)},initCluster.prototype.silhouette=function(e,t){this.euclidean=function(e,t){for(var a=0,s=0;s<e.length;s++)a+=(e[s]-t[s])*(e[s]-t[s]);return Math.sqrt(a)};for(var a=0,s=0,i=0,n=0,r=0;r<e.length;r++){for(var o=0;o<e.length;o++)a+=this.euclidean(e[r],e[o]),s++;for(o=0;o<t.length;o++)i+=this.euclidean(e[r],t[o]),n++}return((i/=n)-(a/=s))/Math.max(a,i)},initCluster.prototype.visualHypertree=function(){var e=this.neuralNTree.neuralNTree.toJSON(),i=new $jit.Hypertree({injectInto:"neural-n-tree-hyperbolic",width:800,height:800,Node:{dim:9,color:"#f00"},Edge:{lineWidth:2,color:"#088"},onBeforeCompute:function(e){},onCreateLabel:function(e,s){e.innerHTML=s.name,$jit.util.addEvent(e,"click",function(){i.onClick(s.id,{onComplete:function(){s.id.split("_")[0];for(var e=self.neuralNTree.neuralNTree.levelOrder(),t=0;t<e.length;t++)for(var a=0;a<e[t].length;a++)e[t][a].index;i.controller.onComplete()}})})},onPlaceLabel:function(e,t){var a=e.style;a.display="",a.cursor="pointer",t._depth<=1?(a.fontSize="0.8em",a.color="#ddd"):2==t._depth?(a.fontSize="0.7em",a.color="#555"):a.display="none";var s=parseInt(a.left),i=e.offsetWidth;a.left=s-i/2+"px"},onComplete:function(){}});i.loadJSON(e),i.refresh(),i.controller.onComplete(),this.ht=i},initCluster.prototype.visualiseNeuralNTree=function(){var u=this;this.mergeIndices={},this.nodes=new vis.DataSet,this.edges=new vis.DataSet,this.levelCount=0,this.visual&&(this.visual.destroy(),this.visual=null),this.lastNodes=[];for(var e=this.neuralNTree.neuralNTree.levelOrder(this.neuralNTree.neuralNTree.rootNode),t=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,a=e.length-1;0<=a;a--){for(var s=!1,i=0,n=e[a].length;i<n;i++)null!==e[a][i]&&(s=!0);s||e.splice(a,1)}var r=[];for(a=0,n=e[0][0].point.length;a<n;a++)r.push(e[0][0].point[a]);for(a=0,n=e.length;a<n;a++){i=0;for(var o=e[a].length;i<o;i++)if(null!==e[a][i])for(var l=0,d=e[a][i].point.length;l<d;l++)r[l]>e[a][i].point[l]&&(r[l]=e[a][i].point[l]),0==r[l]&&(r[l]=1e-8)}for(var c=null,p=null,m=(a=0,e.length);a<m;a++)for(i=0,o=e[a].length;i<o;i++)if(null!==e[a][i]&&e[a][i]!==this.neuralNTree.neuralNTree.rootNode&&e[a][i]!==this.neuralNTree.neuralNTree.rootNode.left&&e[a][i]!==this.neuralNTree.neuralNTree.rootNode.right){var h=e[a][i].point,g=NNTFunctions.util.similarity(h,r);null===c&&(c=g),null===p&&(p=g),c<g&&(c=g),g<p&&(p=g)}this.levelCount=e.length;var b=getHeaders(t[0]);for(a=0,n=e.length;a<n;a++){i=0;for(var y=e[a].length;i<y;i++)if(null!==e[a][i]){var v="<input type='text' style='width: 290px;' value='",f=e[a][i].point,O="<div class='nnt-point-container'>";for(l=0,d=f.length;l<d;l++)v+=l!==d-1?f[l].toFixed(4)+", ":f[l].toFixed(4),O+="<div class='input-group'><span class='input-group-addon'>"+b[l]+"</span><input type='text' id='node-index_"+l+"_"+e[a][i].index+"' class='node-index' onchange='pointChange(this)'></div>";O+="</div>",v+="' placeholder='point' id='node-index_"+e[a][i].index+"' class='node-index' onchange='pointChange(this)'>";g=NNTFunctions.util.similarity(f,r);g=parseInt(NNTFunctions.util.convertRange([g],[c,p],[0,255]));var j=e[a][i].isTerminal?"Terminal "+e[a][i].index:"Node "+e[a][i].index;g<0?g=0:255<g&&(g=255);var S="rgba("+(255-g)+","+g+","+(255-g)+",1)";e[a][i].mergeIndex&&(this.mergeIndices[e[a][i].mergeIndex]=!0),this.nodes.add({id:e[a][i].index,label:e[a][i].index,level:a,info:v,points:O,size:25,shape:"square",featureCount:0,color:S,nodeHeader:j,cid:e[a][i].mergeIndex,currentPoints:O}),this.lastNodes.push({id:e[a][i].index,label:e[a][i].index,level:a,info:v,points:O,size:25,shape:"square",featureCount:0,color:S,nodeHeader:j,cid:e[a][i].mergeIndex,currentPoints:O}),null!==e[a][i].parent&&this.edges.add({from:e[a][i].index,to:e[a][i].parent.index})}}var N=document.getElementById("neural-n-tree-visual"),T={nodes:this.nodes,edges:this.edges};this.visual=new vis.Network(N,T,{edges:{smooth:{type:"cubicBezier",forceDirection:"vertical",roundness:.4}},layout:{hierarchical:{direction:"UD"}},physics:!1}),this.visual.on("click",function(e){var t=e.nodes,a=u.nodes.get(t);if(a&&a[0]&&a&&a[0]&&a[0].points){for(var s=a[0].points,i=a[0].nodeHeader,n=($("<div class='change-nnt-point'></div>").html(s).dialog({width:750,height:600,closeOnEscape:!1,title:i,close:function(){$(this).dialog("destroy").remove()}}),u.neuralNTree.neuralNTree.nodesByIndex([t[0]]).point),r=0,o=n.length;r<o;r++)n[r]=parseFloat(n[r]);var l=$(".change-nnt-point .node-index"),d=[];for(var c in l)l.hasOwnProperty(c)&&"INPUT"===l[c].nodeName&&d.push(l[c]);for(r=d.length-1;0<=r;r--)d[r].id.split("_")[2]!=t[0]&&d.splice(r,1);for(r=0;r<d.length;r++)d[r].value=0==n[r]?n[r]:n[r].toFixed(4)}})},initClassification.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper),f=this;showLoader();var t=isChrome()?analysisObjects.urls.templateUrl+"classification.html":"templates/classification.html";e.load(t,function(){f.tree=f.classification.decisionTree,f.nodes=new vis.DataSet,f.edges=new vis.DataSet,f.levelCount=0,f.visual&&(f.visual.destroy(),f.visual=null);for(var e=getLevelOrder(f.tree.root),t=0,a=e.length;t<a;t++){f.levelCount++;for(var s=0,i=e[t].length;s<i;s++)if(null!==e[t][s]&&void 0!==e[t][s]){for(var n=1,r=e[t][s].parent;-1<e[t].indexOf(r);)n++,r=r.parent;var o=e[t][s].predicateName,l="";l=">="===o?" is greater than or equal to ":"<="===o?" is less than or equal to ":"=="===o?" is equal to ":" is not equal to ";var d=e[t][s].pivot;isNaN(d)||(d=parseFloat(d).toFixed(2)),f.nodes.add({label:e[t][s].category?1==e[t][s].category?"well":0==e[t][s].category?"neurtral":"not well":e[t][s].attribute+l+d,level:f.levelCount+n,id:e[t][s].index,size:25,shape:"square",featureCount:0,color:1==e[t][s].category?"green":0==e[t][s].category?"blue":e[t][s].category?"red":e[t][s].noMatch?"orange":"yellow",info:e[t][s].pivot,predicate:e[t][s].predicateName,nodeId:e[t][s].index,attribute:e[t][s].attribute,category:e[t][s].category});var c=e[t][s].noMatch?"no":"yes";null!==e[t][s].parent&&void 0!==e[t][s].parent&&f.edges.add({from:e[t][s].index,to:e[t][s].parent.index,label:c})}}var u=document.getElementById("display-tree"),p={nodes:f.nodes,edges:f.edges};if(f.visual=new vis.Network(u,p,{edges:{smooth:{type:"cubicBezier",forceDirection:"vertical",roundness:.4}},layout:{hierarchical:{direction:"UD",nodeSpacing:300}},physics:{enabled:!1}}),f.visual.on("afterDrawing",function(e){logClassification()}),automatic){var m=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet;for(p=[],t=0;t<m.length;t++){var h={};for(var g in m[t])"users"!==g&&(g in analysisObjects.miners.ignoredAttributes||"wellPerformed"===g)||(h[g]=m[t][g]);p.push(h)}var b=[];for(t=0;t<p.length;t++){var y=analysisObjects.miners.decisionTree.decisionTree.predict(p[t]);$("#users").html("");var v={};v.users=p[t].users,v.status=y,b.push(v)}generateUserList(b)}f.visual.on("click",function(e){var t=e.nodes,a=f.nodes.get(t);if(a&&a[0])if(a&&a[0]&&a[0].info){var s="Feature value <input class='pivot' value='"+(isNaN(a[0].info)?a[0].info:parseFloat(a[0].info).toFixed(2))+"' id='pivot_"+a[0].nodeId+"'><br>";for(var i in"=="===a[0].predicate?s+="How to compare <select id='predicate_"+a[0].nodeId+"' class='predicate'><option value='==' selected='selected'>equal</option><option value='!='>not equal</option><option value='>='>greater than or equal</option><option value='<='>less than or equal</option></select>":">="===a[0].predicate?s+="How to compare <select id='predicate_"+a[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!='>not equal</option><option value='>=' selected='selected'>greater than or equal</option><option value='<='>less than or equal</option></select>":"<="===a[0].predicate?s+="How to compare <select id='predicate_"+a[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!='>not equal</option><option value='>='>greater than or equal</option><option value='<=' selected='selected'>less than or equal</option></select>":s+="How to compare <select id='predicate_"+a[0].nodeId+"' class='predicate'><option value='=='>equal</option><option value='!=' selected='selected'>not equal</option><option value='>='>greater than or equal</option><option value='<='>less than or equal</option></select>",s+="<br>",s+="Feature <select id='attribute_"+a[0].nodeId+"' class='attribute'>",analysisObjects.miners.dataSet[0])i in analysisObjects.miners.ignoredAttributes||(s+=a[0].attribute==i?"<option value='"+i+"' selected='selected'>"+i+"</option>":"<option value='"+i+"'>"+i+"</option>");s+="</select>";$("<div></div>").html(s).dialog({width:300,height:400,closeOnEscape:!1,close:function(){$(this).dialog("destroy").remove()}});$(".pivot").on("change",function(e){for(var t=e.target.id,a=t.split("_")[1],s=getLevelOrder(f.tree.root),i=0;i<s.length;i++)for(var n=0;n<s[i].length;n++)s[i][n]&&s[i][n].index==a&&(s[i][n].pivot=$("#"+t).val());f.createUI()}),$(".predicate").on("change",function(e){for(var t=e.target.id,a=t.split("_")[1],s=getLevelOrder(f.tree.root),i=0;i<s.length;i++)for(var n=0;n<s[i].length;n++)s[i][n]&&s[i][n].index==a&&(s[i][n].predicateName=$("#"+t).val());f.createUI()}),$(".attribute").on("change",function(e){for(var t=e.target.id,a=t.split("_")[1],s=getLevelOrder(f.tree.root),i=0;i<s.length;i++)for(var n=0;n<s[i].length;n++)s[i][n]&&s[i][n].index==a&&(s[i][n].attribute=$("#"+t).val());f.createUI()})}else{s=1==a[0].category?"<select id='category_"+a[0].nodeId+"' class='category'><option value='1' selected='selected'>Good</option><option value='0' selected='selected'>Medium</option><option value='-1'>Bad<option></select>":"<select id='category_"+a[0].nodeId+"' class='category'><option value='1'>Good</option><option value='0'>Medium</option><option value='-1' selected='selected'>Bad<option></select>",$("<div></div>").html(s).dialog({width:300,height:400,closeOnEscape:!1,close:function(){$(this).dialog("destroy").remove()}});$(".category").on("change",function(e){for(var t=e.target.id,a=t.split("_")[1],s=getLevelOrder(f.tree.root),i=0;i<s.length;i++)for(var n=0;n<s[i].length;n++)s[i][n]&&s[i][n].index==a&&(s[i][n].category=parseInt($("#"+t).val()));f.createUI()})}}),f.generateClassificationTable(),hideLoader()})},initClassification.prototype.generateClassificationTable=function(){for(var e=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,t=[],a=0;a<e.length;a++){var s={};for(var i in e[a])"users"!==i&&(i in analysisObjects.miners.ignoredAttributes||"wellPerformed"===i)||(s[i]=e[a][i]);t.push(s)}var n="<table id='c-table' class='table'><thead><tr>";for(var i in t[0])n+="<th>"+i+"</th>";n+="</tr><tbody>";for(a=0;a<t.length;a++){var r=this.tree.predict(t[a]);s=t[a];for(var i in n+=1==r?"<tr class='success'>":0==r?"<tr>":"<tr class='danger'>",s)if(!(i in analysisObjects.miners.ignoredAttributes)||"users"===i){var o=s[i];n+="<td>"+(o=!isNaN(o)&&o?+o.toFixed(2):o)+"</td>"}n+="</tr>"}n+="</tbody></table>",$("#classification-table").html(n),$("#c-table").tablesorter()},initAnomaly.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper),u=this;showLoader();var t=isChrome()?analysisObjects.urls.templateUrl+"anomaly.html":"templates/anomaly.html";e.load(t,function(){if(!analysisObjects.miners.anomaly)if(analysisObjects.miners.dataSet)try{u.anomaly=new Anomaly}catch(e){return void hideLoader()}else alert("No data set loaded");if($("#apply-anomaly").on("click",function(e){showLoader();for(var t=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,a=[],s="",i=0;i<t.length;i++){var n={};for(var r in t[i])"users"!==r&&(r in analysisObjects.miners.ignoredAttributes||"anomaly"===r)||(n[r]=t[i][r]);a.push(n)}var o=[];for(i=0;i<a.length;i++){var l=-1==u.anomaly.anomaly.predict(a[i]);o.push({input:getInputVectorTextAllAttributes(t[i]),status:l})}s="<table id='a-table' class='table'><thead><tr>";var d=getKeysAllAttributes(t[0]);for(i=0;i<d.length;i++)s+="<th>"+d[i]+"</th>";s+="</tr></thead><tbody>";for(i=0;i<o.length;i++){s+=o[i].status?"<tr class='danger'>":"<tr class='success'>";for(var c=0;c<o[i].input.length;c++)1e-6==o[i].input[c]&&(o[i].input[c]=0),!isNaN(o[i].input[c])&&o[i].input[c]?s+="<td>"+ +o[i].input[c].toFixed(2)+"</td>":s+="<td>"+o[i].input[c]+"</td>";s+="</tr>"}s+="</tbody></table>",$("#anomaly-table").html(s),$("#a-table").tablesorter(),hideLoader(),logAnomaly()}),hideLoader(),analysisObjects.miners.anomaly){u.anomaly=analysisObjects.miners.anomaly;var e=analysisObjects.miners.anomaly.th||$("#anomaly-threshold").val();$("#anomaly-threshold").val(e),$("#apply-anomaly").click()}})},initCharts.prototype.createUI=function(){$(analysisObjects.uiConstants.wrapper);var e=this;showLoader(),$("#charts-radar").remove(),$("#charts-line").remove(),e.dataSet=analysisObjects.miners.curDataSet||analysisObjects.miners.groupDataSet||analysisObjects.miners.reducedTimeDataSet||analysisObjects.miners.dataSet,e.curDataSet=[];for(var t in e.dataSet[0]){var a=[];if(!(isNaN(e.dataSet[0][t])||t in analysisObjects.miners.ignoredAttributes)){for(var s=0;s<e.dataSet.length;s++)a.push(e.dataSet[s][t]);e.curDataSet.push({label:t,data:a,backgroundColor:"rgba("+Math.floor(250*Math.random())+","+Math.floor(250*Math.random())+","+Math.floor(250*Math.random())+",0.3)"})}}e.labels=[];for(s=0;s<e.dataSet.length;s++)e.labels.push(s+"");var i={type:"radar",data:{labels:e.labels,datasets:e.curDataSet},options:{}};e.labels,e.curDataSet;e.chartOptions=i,e.radarChart=chart,e.lineChart=lineChart,hideLoader()},initApriori.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper),i=this,t=isChrome()?analysisObjects.urls.templateUrl+"apriori.html":"templates/apriori.html";e.load(t,function(){$("#apriori-apply").on("click",function(e){var t=$("#apriori-min-confidence").val(),a=$("#apriori-min-support").val(),s=$("#apriori-iterations").val();try{t=parseFloat(t),a=parseFloat(a),s=parseInt(s)}catch(e){return void alert("Not a proper apriori-value")}i.apriori=new Association(t,a,!1,s).apriori,i.buildUI()}),analysisObjects.miners.apriori&&(i.apriori=analysisObjects.miners.apriori.apriori,i.buildUI()),$("#apriori-apply").click()})},initApriori.prototype.buildUI=function(){for(var e=this.apriori.frequentItemSets,t=this.apriori.associationRules,a=[],s=[],i={},n=0;n<t.length;n++){var r=t[n],o={};o.id=r.lhs.join();for(var l=0;l<r.lhs.length;l++)r.lhs[l]=isNaN(r.lhs[l])?r.lhs[l]:+r.lhs[l].toFixed(2);o.label=r.lhs.join();var d={};d.id=r.rhs.join();for(l=0;l<r.rhs.length;l++)r.rhs[l]=isNaN(r.rhs[l])?r.rhs[l]:+r.rhs[l].toFixed(2);d.label=r.rhs.join();var c={};c.from=o.id,c.to=d.id,c.arrows="from",i[o.id]||a.push(o),i[d.id]||a.push(d),s.push(c),i[o.id]=!0,i[d.id]=!0}i=null;for(var u=0;u<t.length;u++){"<tr><td>"+(r=t[u]).lhs.join()+"</td><td>"+r.rhs.join()+"</td><td>"+r.confidence+"</td></tr>"}for(var u in e)for(var p=e[u],m=0;m<p.length;m++){var h=p[m];"<tr><td>"+h.itemSet.join()+"</td><td>"+h.support+"</td></tr>"}var g={nodes:a,edges:s},b=document.getElementById("apriori-table");b.style.width="900px",b.style.height="900px",new vis.Network(b,g,{}).on("afterDrawing",function(e){logApriori()})},Reflect.prototype.createUI=function(){var e=$(analysisObjects.uiConstants.wrapper);showLoader();var t=isChrome()?analysisObjects.urls.templateUrl+"options.html":"templates/options.html";e.load(t,function(){hideLoader()})};