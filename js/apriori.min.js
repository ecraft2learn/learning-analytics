!function(t,n){"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define("apriori",[],n):t.Apriori=n()}(this,function(){"use strict"
var t
return function(t){var n=function(){function t(t,n){this.frequentItemSets=t,this.associationRules=n}return t}()
t.AnalysisResult=n
var e=function(){function t(t,n){this.itemSet=t,this.support=n}return t}()
t.FrequentItemSet=e
var r=function(){function t(t,n,e){this.lhs=t,this.rhs=n,this.confidence=e}return t}()
t.AssociationRule=r
var o=function(){function r(t,n,e){this.minSupport=t?0===t?0:t:.1,this.minConfidence=n?0===n?0:n:.1,this.debugMode=e||!1}return r.prototype.analyze=function(e){var r=this,o=(new Date).getTime(),u={},f={},a=r.toOneElementItemSets(e),s=r.findItemSetsMinSupportSatisfied(a,e,r.minSupport,u),c=s,g=1
r.debugMode&&console.log("Before finding item sets: "+r.getTime(o)+" ms")
for(var l=function(t){return t.itemSet};0!==c.length;){f[g]=c
var h=i.toFixedSizeJoinedSets(c.map(l),g+1)
c=r.findItemSetsMinSupportSatisfied(h,e,r.minSupport,u),g+=1}r.debugMode&&console.log("After finding item sets: "+r.getTime(o)+" ms")
var S=function(t,n,e){var r=n[t.toString()]
return r?r/e.length:0},p=[],m=function(t){var n=!1
return p.forEach(function(e){n||(n=e.toString()===t.toString())}),n}
r.debugMode&&console.log("Before calculating association rules: "+r.getTime(o)+" ms")
var v,d=[],y=function(n){var o=i.getDiffArray(v,n)
if(o.length>0){var f=S(v,u,e),a=S(n,u,e),s=f/a
!isNaN(s)&&!m(n)&&s>=r.minConfidence&&(p.push(n),d.push(new t.AssociationRule(n,o,s)))}},A=function(t){v=t,i.toAllSubSets(v).forEach(y)}
for(var E in f){var b=f[E].map(l)
0===b.length||b[0].length<=1||b.forEach(A)}r.debugMode&&console.log("After calculating association rules: "+r.getTime(o)+" ms")
var x=new n(f,d)
return r.debugMode&&(console.log("AnalysisResult: "+JSON.stringify(x)),console.log("Apriori.Algorithm's total spent time: "+r.getTime(o)+" ms")),x},r.prototype.toOneElementItemSets=function(t){var n=[]
return t.forEach(function(t){t.forEach(function(t){n.push([t])})}),i.toArraySet(n)},r.prototype.findItemSetsMinSupportSatisfied=function(t,n,r,o){var u=[],f={}
t.forEach(function(t){n.forEach(function(n){i.isSubSetArrayOf(t,n)&&(o[t.toString()]||(o[t.toString()]=0),f[t.toString()]||(f[t.toString()]=0),o[t.toString()]+=1,f[t.toString()]+=1)})})
var a=!1,s=function(t){a||(a=t.itemSet.toString()===g.toString())}
for(var c in f){var g=c.split(",").sort(),l=f[g.toString()],h=l/n.length
h>=r&&(a=!1,u.forEach(s),a||u.push(new e(g,h)))}return u},r.prototype.showAnalysisResultFromFile=function(t){var n=this,e=t
return n.analyze(e)},r.prototype.getTime=function(t){return(new Date).getTime()-t},r}()
t.Algorithm=o
var i=function(){function t(){}return t.toStringSet=function(t){var n=[]
return t.forEach(function(t){-1===n.indexOf(t)&&n.push(t)}),n},t.toArraySet=function(t){var n={},e=[]
return t.forEach(function(t){n.hasOwnProperty(t.toString())||(e.push(t),n[t.toString()]=!0)}),e},t.toAllSubSets=function(n){var e=function(n,r,o,i){if(0===n)o.length>0&&(i[i.length]=t.toStringSet(o))
else for(var u=0;u<r.length;u++){var f=n-1,a=r.slice(u+1),s=o.concat([r[u]])
e(f,a,s,i)}},r=[]
n.sort()
for(var o=1;o<n.length;o++)e(o,n,[],r)
return r.push(n),t.toArraySet(r)},t.toFixedSizeJoinedSets=function(n,e){var r=[]
return n.forEach(function(o){n.forEach(function(n){if(t.getDiffArray(o,n).length>0){var i=[].concat(o).concat(n),u=t.toStringSet(i)
u.length===e&&r.push(u)}})}),t.toArraySet(r)},t.isSubSetArrayOf=function(t,n){var e=!0
return t.forEach(function(t){e&&-1===n.indexOf(t)&&(e=!1)}),e},t.getDiffArray=function(t,n){var e=[]
return t.forEach(function(t){-1===n.indexOf(t)&&e.push(t)}),e},t.readCSVToArray=function(t,n){n=n||","
for(var e,r=new RegExp("(\\"+n+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+n+"\\r\\n]*))","gi"),o=[[]];e=r.exec(t);){var i=e[1]
i.length&&i!==n&&o.push([])
var u=e[2]?e[2].replace(new RegExp('""',"g"),'"'):e[3]
u.length>0&&o[o.length-1].push(u)}return o},t}()
t.ArrayUtils=i}(t||(t={})),t})
