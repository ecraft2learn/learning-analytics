!function(t,n){"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define("apriori",[],n):t.Apriori=n()}(this,function(){"use strict"
var t
return function(t){var n=function(){function t(t,n){this.frequentItemSets=t,this.associationRules=n}return t}()
t.AnalysisResult=n
var e=function(){function t(t,n){this.itemSet=t,this.support=n}return t}()
t.FrequentItemSet=e
var r=function(){function t(t,n,e){this.lhs=t,this.rhs=n,this.confidence=e}return t}()
t.AssociationRule=r
var i=function(){function r(t,n,e,r){this.minSupport=t?0===t?0:t:.1,this.minConfidence=n?0===n?0:n:.1,this.debugMode=e||!1,this.iterations=r||5}return r.prototype.analyze=function(e){var r=this,i=(new Date).getTime(),u={},a={},f=r.toOneElementItemSets(e),s=r.findItemSetsMinSupportSatisfied(f,e,r.minSupport,u),c=s,g=1
r.debugMode&&console.log("Before finding item sets: "+r.getTime(i)+" ms")
for(var l=function(t){return t.itemSet};0!==c.length;){a[g]=c
var h=o.toFixedSizeJoinedSets(c.map(l),g+1)
if(c=r.findItemSetsMinSupportSatisfied(h,e,r.minSupport,u),(g+=1)>=r.iterations)break}r.debugMode&&console.log("After finding item sets: "+r.getTime(i)+" ms")
var S=function(t,n,e){var r=n[t.toString()]
return r?r/e.length:0},p=[],m=function(t){var n=!1
return p.forEach(function(e){n||(n=e.toString()===t.toString())}),n}
r.debugMode&&console.log("Before calculating association rules: "+r.getTime(i)+" ms")
var v,d=[],y=function(n){var i=o.getDiffArray(v,n)
if(i.length>0){var a=S(v,u,e),f=S(n,u,e),s=a/f
!isNaN(s)&&!m(n)&&s>=r.minConfidence&&(p.push(n),d.push(new t.AssociationRule(n,i,s)))}},A=function(t){v=t,o.toAllSubSets(v).forEach(y)}
for(var E in a){var b=a[E].map(l)
0===b.length||b[0].length<=1||b.forEach(A)}r.debugMode&&console.log("After calculating association rules: "+r.getTime(i)+" ms")
var x=new n(a,d)
return r.debugMode&&(console.log("AnalysisResult: "+JSON.stringify(x)),console.log("Apriori.Algorithm's total spent time: "+r.getTime(i)+" ms")),x},r.prototype.toOneElementItemSets=function(t){var n=[]
return t.forEach(function(t){t.forEach(function(t){n.push([t])})}),o.toArraySet(n)},r.prototype.findItemSetsMinSupportSatisfied=function(t,n,r,i){var u=[],a={}
t.forEach(function(t){n.forEach(function(n){o.isSubSetArrayOf(t,n)&&(i[t.toString()]||(i[t.toString()]=0),a[t.toString()]||(a[t.toString()]=0),i[t.toString()]+=1,a[t.toString()]+=1)})})
var f=!1,s=function(t){f||(f=t.itemSet.toString()===g.toString())}
for(var c in a){var g=c.split(",").sort(),l=a[g.toString()],h=l/n.length
h>=r&&(f=!1,u.forEach(s),f||u.push(new e(g,h)))}return u},r.prototype.showAnalysisResultFromFile=function(t){var n=this,e=t
return n.analyze(e)},r.prototype.getTime=function(t){return(new Date).getTime()-t},r}()
t.Algorithm=i
var o=function(){function t(){}return t.toStringSet=function(t){var n=[]
return t.forEach(function(t){-1===n.indexOf(t)&&n.push(t)}),n},t.toArraySet=function(t){var n={},e=[]
return t.forEach(function(t){n.hasOwnProperty(t.toString())||(e.push(t),n[t.toString()]=!0)}),e},t.toAllSubSets=function(n){var e=function(n,r,i,o){if(0===n)i.length>0&&(o[o.length]=t.toStringSet(i))
else for(var u=0;u<r.length;u++){var a=n-1,f=r.slice(u+1),s=i.concat([r[u]])
e(a,f,s,o)}},r=[]
n.sort()
for(var i=1;i<n.length;i++)e(i,n,[],r)
return r.push(n),t.toArraySet(r)},t.toFixedSizeJoinedSets=function(n,e){var r=[]
return n.forEach(function(i){n.forEach(function(n){if(t.getDiffArray(i,n).length>0){var o=[].concat(i).concat(n),u=t.toStringSet(o)
u.length===e&&r.push(u)}})}),t.toArraySet(r)},t.isSubSetArrayOf=function(t,n){var e=!0
return t.forEach(function(t){e&&-1===n.indexOf(t)&&(e=!1)}),e},t.getDiffArray=function(t,n){var e=[]
return t.forEach(function(t){-1===n.indexOf(t)&&e.push(t)}),e},t.readCSVToArray=function(t,n){n=n||","
for(var e,r=new RegExp("(\\"+n+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+n+"\\r\\n]*))","gi"),i=[[]];e=r.exec(t);){var o=e[1]
o.length&&o!==n&&i.push([])
var u=e[2]?e[2].replace(new RegExp('""',"g"),'"'):e[3]
u.length>0&&i[i.length-1].push(u)}return i},t}()
t.ArrayUtils=o}(t||(t={})),t})
