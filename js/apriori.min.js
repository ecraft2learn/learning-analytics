(function(a,b){if(typeof exports==="object"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define("apriori",[],b)}else{a.Apriori=b()}}}(this,function(){var a;(function(c){var e=(function(){function h(i,j){this.frequentItemSets=i;this.associationRules=j}return h})();c.AnalysisResult=e;var g=(function(){function h(j,i){this.itemSet=j;this.support=i}return h})();c.FrequentItemSet=g;var b=(function(){function h(i,k,j){this.lhs=i;this.rhs=k;this.confidence=j}return h})();c.AssociationRule=b;var d=(function(){function h(l,i,k,j){this.minSupport=l?l===0?0:l:0.1;this.minConfidence=i?i===0?0:i:0.1;this.debugMode=k||false;this.iterations=j||5}h.prototype.analyze=function(w){var u=this;var v=new Date().getTime();var n={};var y={};var s=u.toOneElementItemSets(w);var j=u.findItemSetsMinSupportSatisfied(s,w,u.minSupport,n);var p=j;var l=1;if(u.debugMode){console.log("Before finding item sets: "+u.getTime(v)+" ms")}var A=function(k){return k.itemSet};while(p.length!==0){y[l]=p;var D=f.toFixedSizeJoinedSets(p.map(A),l+1);p=u.findItemSetsMinSupportSatisfied(D,w,u.minSupport,n);l+=1;if(l>=u.iterations){break}}if(u.debugMode){console.log("After finding item sets: "+u.getTime(v)+" ms")}var C=function(E,G,k){var F=G[E.toString()];return F?F/k.length:0};var o=[];var i=function(k){var E=false;o.forEach(function(F){if(!E){E=F.toString()===k.toString()}});return E};if(u.debugMode){console.log("Before calculating association rules: "+u.getTime(v)+" ms")}var r=[];var B;var m=function(F){var H=f.getDiffArray(B,F);if(H.length>0){var G=C(B,n,w),k=C(F,n,w),E=G/k;if(!isNaN(E)&&!i(F)&&E>=u.minConfidence){o.push(F);r.push(new c.AssociationRule(F,H,E))}}};var t=function(k){B=k;f.toAllSubSets(B).forEach(m)};for(var x in y){var z=y[x].map(A);if(z.length===0||z[0].length<=1){continue}z.forEach(t)}if(u.debugMode){console.log("After calculating association rules: "+u.getTime(v)+" ms")}var q=new e(y,r);if(u.debugMode){console.log("AnalysisResult: "+JSON.stringify(q));console.log("Apriori.Algorithm's total spent time: "+u.getTime(v)+" ms")}return q};h.prototype.toOneElementItemSets=function(i){var j=[];i.forEach(function(k){k.forEach(function(l){j.push([l])})});return f.toArraySet(j)};h.prototype.findItemSetsMinSupportSatisfied=function(l,t,q,j){var k=[],o={};l.forEach(function(u){t.forEach(function(v){if(f.isSubSetArrayOf(u,v)){if(!j[u.toString()]){j[u.toString()]=0}if(!o[u.toString()]){o[u.toString()]=0}j[u.toString()]+=1;o[u.toString()]+=1}})});var n=false;var m=function(u){if(!n){n=u.itemSet.toString()===i.toString()}};for(var s in o){var i=s.split(",").sort(),p=o[i.toString()],r=p/t.length;if(r>=q){n=false;k.forEach(m);if(!n){k.push(new g(i,r))}}}return k};h.prototype.showAnalysisResultFromFile=function(l){var k=this;var j=l;var i=k.analyze(j);return i};h.prototype.getTime=function(i){return new Date().getTime()-i};return h})();c.Algorithm=d;var f=(function(){function h(){}h.toStringSet=function(j){var i=[];j.forEach(function(k){if(i.indexOf(k)===-1){i.push(k)}});return i};h.toArraySet=function(k){var i={},j=[];k.forEach(function(l){if(!i.hasOwnProperty(l.toString())){j.push(l);i[l.toString()]=true}});return j};h.toAllSubSets=function(m){var l=function(u,q,s,o){if(u===0){if(s.length>0){o[o.length]=h.toStringSet(s)}}else{for(var i=0;i<q.length;i++){var r=u-1,p=q.slice(i+1),t=s.concat([q[i]]);l(r,p,t,o)}}};var j=[];m.sort();for(var k=1;k<m.length;k++){l(k,m,[],j)}j.push(m);return h.toArraySet(j)};h.toFixedSizeJoinedSets=function(k,j){var i=[];k.forEach(function(l){k.forEach(function(n){if(h.getDiffArray(l,n).length>0){var o=[].concat(l).concat(n),m=h.toStringSet(o);if(m.length===j){i.push(m)}}})});return h.toArraySet(i)};h.isSubSetArrayOf=function(k,j){var i=true;k.forEach(function(l){if(i&&j.indexOf(l)===-1){i=false}});return i};h.getDiffArray=function(j,i){var k=[];j.forEach(function(l){if(i.indexOf(l)===-1){k.push(l)}});return k};h.readCSVToArray=function(o,k){k=k||",";var n=new RegExp(("(\\"+k+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+k+"\\r\\n]*))"),"gi");var m=[[]];var i;while(!!(i=n.exec(o))){var l=i[1];if(l.length&&l!==k){m.push([])}var j=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3];if(j.length>0){m[m.length-1].push(j)}}return m};return h})();c.ArrayUtils=f})(a||(a={}));return a}));